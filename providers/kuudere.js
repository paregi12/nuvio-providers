/**
 * kuudere - Built from src/kuudere/
 * Generated: 2026-01-10T10:56:32.740Z
 */
var ut=Object.create;var M=Object.defineProperty,ft=Object.defineProperties,pt=Object.getOwnPropertyDescriptor,dt=Object.getOwnPropertyDescriptors,ht=Object.getOwnPropertyNames,B=Object.getOwnPropertySymbols,mt=Object.getPrototypeOf,G=Object.prototype.hasOwnProperty,gt=Object.prototype.propertyIsEnumerable;var P=(n,s,r)=>s in n?M(n,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[s]=r,U=(n,s)=>{for(var r in s||(s={}))G.call(s,r)&&P(n,r,s[r]);if(B)for(var r of B(s))gt.call(s,r)&&P(n,r,s[r]);return n},_=(n,s)=>ft(n,dt(s));var yt=(n,s,r,t)=>{if(s&&typeof s=="object"||typeof s=="function")for(let o of ht(s))!G.call(n,o)&&o!==r&&M(n,o,{get:()=>s[o],enumerable:!(t=pt(s,o))||t.enumerable});return n};var R=(n,s,r)=>(r=n!=null?ut(mt(n)):{},yt(s||!n||!n.__esModule?M(r,"default",{value:n,enumerable:!0}):r,n));var m=(n,s,r)=>new Promise((t,o)=>{var a=i=>{try{l(r.next(i))}catch(c){o(c)}},e=i=>{try{l(r.throw(i))}catch(c){o(c)}},l=i=>i.done?t(i.value):Promise.resolve(i.value).then(a,e);l((r=r.apply(n,s)).next())});var X=R(require("axios"));var L="https://kuudere.ru",w="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36";function I(t,o){return m(this,arguments,function*(n,s,r={}){let a=s.startsWith("http")?s:`${L}${s}`;try{return yield(0,X.default)(_(U({method:n,url:a},r),{headers:U({"User-Agent":w,Referer:L,"X-Requested-With":"XMLHttpRequest"},r.headers)}))}catch(e){throw console.error(`[Kuudere] Request error (${a}):`,e.message),e}})}var z=R(require("axios"));var wt="68e094699525b18a70bab2f86b1fa706";function H(n,s){return m(this,null,function*(){let t=`https://api.themoviedb.org/3/${s==="tv"||s==="series"?"tv":"movie"}/${n}?api_key=${wt}&language=en-US`;try{let a=(yield z.default.get(t)).data;return{title:a.name||a.title,year:(a.first_air_date||a.release_date||"").split("-")[0]}}catch(o){return console.error("[Kuudere] TMDB metadata error:",o.message),null}})}var K=R(require("axios")),x=R(require("crypto-js"));function E(n,s,r=new Set){if(r.has(n))return null;r.add(n);let t=s[n];if(typeof t=="number")return s[t]!==void 0?E(t,s,r):t;if(Array.isArray(t))return t.map(o=>typeof o=="number"?E(o,s,new Set(r)):o);if(t&&typeof t=="object"){let o={};for(let[a,e]of Object.entries(t))o[a]=typeof e=="number"?E(e,s,new Set(r)):e;return o}return t}function N(n,s){if(!n||typeof n!="object")return null;if(n[s])return n[s];for(let r in n){let t=N(n[r],s);if(t)return t}return null}function bt(n){let s=[],r=n.subtitle_links||[];if(Array.isArray(r))for(let t of r)t.url&&s.push({url:t.url,lang:t.language||"English",label:t.language||"English"});if(n.nodes){for(let t of n.nodes)if(t&&t.data){let o=t.data,a=o.find(e=>e&&(e.subtitles||e.tracks));if(a){let e=a.subtitles||a.tracks||[];if(typeof e=="number"&&(e=o[e]||[]),Array.isArray(e))for(let l of e){let i=E(l,o);i&&i.url&&s.push({url:i.url,lang:i.language||i.label||"English",label:i.language||i.label||"English"})}}}}return s}function J(n){return m(this,null,function*(){var s;try{let r=new URL(n),t=`${r.origin}${r.pathname}/__data.json${r.search}`,a=(yield K.default.get(t,{headers:{Referer:"https://kuudere.ru/","User-Agent":w}})).data,e=bt(a),l=(s=a.nodes)==null?void 0:s.find(v=>v&&v.data&&v.data.some(D=>D&&D.obfuscation_seed));if(!l)return{url:null,subtitles:e};let i=l.data,c=i.findIndex(v=>v&&v.obfuscation_seed),u=i[c],d=i[u.obfuscation_seed],h=x.default.SHA256(d).toString(),f={keyField:`kf_${h.substring(8,16)}`,ivField:`ivf_${h.substring(16,24)}`,tokenField:`${h.substring(48,64)}_${h.substring(56,64)}`},g=E(c,i),p=N(g,f.keyField),A=N(g,f.ivField),y=g[f.tokenField];if(!y||!p||!A)return{url:null,subtitles:e};let k=(yield K.default.get(`${r.origin}/api/m3u8/${y}`,{headers:{Referer:n,"User-Agent":w,"X-Requested-With":"XMLHttpRequest"}})).data.video_b64,C=x.default.enc.Base64.parse(p),ct=x.default.enc.Base64.parse(A),lt=x.default.enc.Base64.parse(k);return{url:x.default.AES.decrypt({ciphertext:lt},C,{iv:ct,mode:x.default.mode.CBC,padding:x.default.pad.Pkcs7}).toString(x.default.enc.Utf8),subtitles:e}}catch(r){return null}})}var q=R(require("axios"));function kt(n){try{let s=n.match(new RegExp("eval\\(function\\(p,a,c,k,e,d\\)\\{.*?\\}\\((.*)\\)\\)","s"));if(!s)return null;let r=s[1],t=[],o="",a=!1,e="",l=0;for(let i=0;i<r.length;i++){let c=r[i];if(c==="\\"&&a){o+=c+r[++i];continue}if((c==="'"||c==='"'||c==="`")&&(!a||e===c)){a=!a,e=a?c:"",o+=c;continue}a||(c==="("&&l++,c===")"&&l--),c===","&&!a&&l===0?(t.push(o.trim()),o=""):o+=c}if(t.push(o.trim()),t.length>=4){let i=t[0].substring(1,t[0].length-1),c=parseInt(t[1]),u=parseInt(t[2]),d=t[3].match(new RegExp(`['"](.*?)['"]`,"s"));if(!d)return null;let h=d[1].split("|"),f=function(p){return(p<c?"":f(parseInt(p/c)))+((p=p%c)>35?String.fromCharCode(p+29):p.toString(36))},g={};for(let p=0;p<h.length;p++)h[p]&&(g[f(p)]=h[p]);return i.replace(/\b\w+\b/g,p=>g[p]||p)}}catch(s){}return null}function Rt(n,s){return m(this,null,function*(){if(n.includes("main.js?v=1.1.3")||n.includes("Page is loading, please wait...")){let r=new URL(s),t=["hgplaycdn.com","wishembed.com","strwish.com","dwish.pro","awish.pro","hlswish.com"];for(let o of t){if(o===r.hostname)continue;let a=`https://${o}${r.pathname}${r.search}`;try{let e=yield q.default.get(a,{headers:{Referer:"https://kuudere.ru/","User-Agent":w},timeout:3e3});if(e.data.includes("jwplayer")||e.data.includes("eval(function(p,a,c,k,e,d)"))return e.data}catch(e){}}}return n})}function V(n){return m(this,null,function*(){try{let r=(yield q.default.get(n,{headers:{Referer:"https://kuudere.ru/","User-Agent":w},timeout:5e3})).data;r=yield Rt(r,n);let t=null,o=kt(r);if(o){let a=o.match(/"hls4"\s*:\s*"([^"]+)"/),e=o.match(/"hls3"\s*:\s*"([^"]+)"/),l=o.match(/"hls2"\s*:\s*"([^"]+)"/);if(t=a&&a[1]||e&&e[1]||l&&l[1],!t){let i=o.match(/file\s*:\s*"([^"]+\.(?:m3u8|txt)[^"]*)"/)||o.match(/sources\s*:\s*\[\s*{\s*file\s*:\s*"([^"]+)"/);i&&(t=i[1])}}if(!t){let a=r.match(/file\s*:\s*"([^"]+\.(?:m3u8|txt)[^"]*)"/)||r.match(/sources\s*:\s*\[\s*{\s*file\s*:\s*"([^"]+)"/);a&&(t=a[1])}return t?(t.startsWith("/")&&(t=new URL(n).origin+t),{url:t}):null}catch(s){return null}})}var Q=R(require("axios"));function St(n){let s=[];try{let r=new URL(n);for(let[t,o]of r.searchParams.entries())if(t.startsWith("caption_")){let a=t.replace("caption_","");s.push({url:o,lang:`Caption ${a}`,label:`Caption ${a}`})}}catch(r){}return s}function xt(n){try{let s=n.match(/eval\(function\(p,a,c,k,e,d\)\{.*?\}\((.*)\)\)/);if(s){let r=s[1].match(/'(.*?)',(\d+),(\d+),'(.*?)'\.split\('\|'\)/);if(r){let[t,o,a,e,l]=r;a=parseInt(a),e=parseInt(e),l=l.split("|");let i=function(c){return(c<a?"":i(parseInt(c/a)))+((c=c%a)>35?String.fromCharCode(c+29):c.toString(36))};{let c={};for(;e--;)c[i(e)]=l[e]||i(e);l=[function(u){return c[u]}],e=1}for(;e--;)l[e]&&(o=o.replace(new RegExp("\\b\\w+\\b","g"),function(c){return l[e](c)||c}));return o}}}catch(s){}return null}function Z(n){return m(this,null,function*(){try{let r=(yield Q.default.get(n,{headers:{Referer:"https://kuudere.ru/","User-Agent":w}})).data,t=null,o=r.match(/file\s*:\s*"([^"]+\.(?:m3u8|txt)[^"]*)"/)||r.match(/sources\s*:\s*\[\s*{\s*file\s*:\s*"([^"]+)"/);if(o)t=o[1];else{let e=xt(r);if(e){let l=e.match(/"hls4"\s*:\s*"([^"]+)"/),i=e.match(/"hls3"\s*:\s*"([^"]+)"/),c=e.match(/"hls2"\s*:\s*"([^"]+)"/);if(t=l&&l[1]||i&&i[1]||c&&c[1],!t){let u=e.match(/file\s*:\s*"([^"]+\.(?:m3u8|txt)[^"]*)"/)||e.match(/sources\s*:\s*\[\s*{\s*file\s*:\s*"([^"]+)"/);u&&(t=u[1])}}}if(!t)return null;t.startsWith("/")&&(t=new URL(n).origin+t);let a=St(n);return{url:t,subtitles:a}}catch(s){return null}})}var T=R(require("axios"));function Y(n){return m(this,null,function*(){try{let t=(yield T.default.get(n,{headers:{"User-Agent":w}})).data.match(/\/pass_md5\/([^']*)/);if(!t)return null;let o=t[1],a=`${new URL(n).origin}/pass_md5/${o}`;return{url:`${(yield T.default.get(a,{headers:{Referer:n,"User-Agent":w}})).data}${(u=>{let d="",h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let f=0;f<u;f++)d+=h.charAt(Math.floor(Math.random()*h.length));return d})(10)}?token=${o}&expiry=${Date.now()}`,subtitles:[]}}catch(s){return null}})}var tt=R(require("axios"));function $t(n){try{let s=n.match(/eval\(function\(p,a,c,k,e,d\)\{.*?\}\((.*)\)\)/);if(s){let r=s[1].match(/'(.*?)',(\d+),(\d+),'(.*?)'\.split\('\|'\)/);if(r){let[t,o,a,e,l]=r;a=parseInt(a),e=parseInt(e),l=l.split("|");let i=function(c){return(c<a?"":i(parseInt(c/a)))+((c=c%a)>35?String.fromCharCode(c+29):c.toString(36))};{let c={};for(;e--;)c[i(e)]=l[e]||i(e);l=[function(u){return c[u]}],e=1}for(;e--;)l[e]&&(o=o.replace(new RegExp("\\b\\w+\\b","g"),function(c){return l[e](c)||c}));return o}}}catch(s){}return null}function et(n){return m(this,null,function*(){try{let r=(yield tt.default.get(n,{headers:{"User-Agent":w,Referer:"https://kuudere.ru/"}})).data,t=r.match(/src\s*:\s*"([^"]+\.mp4)"/);if(!t){let o=$t(r);o&&(t=o.match(/src\s*:\s*"([^"]+\.mp4)"/))}return t?{url:t[1],subtitles:[]}:null}catch(s){return null}})}var j=R(require("axios")),S=R(require("crypto-js"));var $=(...n)=>String.fromCharCode(...n),F=(n,s)=>n.charCodeAt(s)||0;function At(n){let s="10",o="",a=["7","5","1","9"];for(let d=0;d<a.length;d++)o+=$(s+a[d]);o+=$(F(n,parseInt(s)/10)),o+=o.substring(1,3),o+=$(110,109,117);let e=["3","5","7","9"];o+=$(e[3]+e[2],e[1]+e[2]);let l=Number(e[0])*1+1+e[3];o+=$(l,l);let i=Number(e[3])*parseInt(s)+Number(e[3])*1,c=e.slice().reverse().join("").substring(0,2);o+=$(i,c);let u=new Uint8Array(o.length);for(let d=0;d<o.length;d++)u[d]=o.charCodeAt(d)&255;return S.default.lib.WordArray.create(u,u.length)}function vt(n,s){let r=n,t=r+"//",o=s,a=r.length*t.length,e=1,l="";for(let p=e;p<10;p++)l+=$(p+a);let i="";i=e+i+e+i+e;let c=i.length*F(o,0),u=parseInt(i)*e+r.length,d=u+4,h=F(r,e),f=h*e-2;l+=$(a,parseInt(i),c,u,d,h,f);let g=new Uint8Array(16);for(let p=0;p<16;p++)g[p]=l.charCodeAt(p)&255;return S.default.lib.WordArray.create(g,g.length)}function rt(n,s,r){return m(this,null,function*(){try{if(!n)return null;let t;if(typeof n=="string")if(/^[0-9a-fA-F]+$/.test(n))t=S.default.enc.Hex.parse(n);else return null;else t=S.default.lib.WordArray.create(new Uint8Array(n));let o=S.default.AES.decrypt({ciphertext:t},s,{iv:r,mode:S.default.mode.CBC,padding:S.default.pad.Pkcs7}),a="";try{a=o.toString(S.default.enc.Utf8)}catch(e){a=o.toString(S.default.enc.Latin1)}if(a&&(a.includes("source")||a.includes("sources")||a.includes("player"))){let e=a.substring(a.indexOf("{"),a.lastIndexOf("}")+1);return JSON.parse(e)}}catch(t){}return null})}function st(n){return m(this,null,function*(){try{let s=new URL(n),r=s.hostname,t=s.protocol,o=s.hash.substring(1).split("&")[0];if(!o)return null;let a=At(t),e=vt(t,r),l=yield j.default.get(`${t}//${r}/api/v1/info?id=${o}`,{headers:{"User-Agent":w,Referer:n,"X-Requested-With":"XMLHttpRequest"},timeout:5e3,responseType:"arraybuffer"}),i=yield rt(l.data,a,e),c=["kuudere.ru",r,"kuudere.to"],u=null;for(let d of c)try{let h=`${t}//${r}/api/v1/video?id=${o}&w=1920&h=1080&u=${d}`,f=yield j.default.get(h,{headers:{"User-Agent":w,Referer:n,"X-Requested-With":"XMLHttpRequest"},timeout:5e3,responseType:"arraybuffer"});if(u=yield rt(f.data,a,e),u&&(u.source||u.cf))break}catch(h){}if(u&&(u.source||u.cf)){let d=[],h=i||u;if(h.subtitles)for(let f of h.subtitles)d.push({url:f.url||f.file||f.src,lang:f.language||f.label||"Unknown",label:f.label||f.language||"Unknown"});else if(h.tracks)for(let f of h.tracks)(f.kind==="captions"||f.kind==="subtitles")&&d.push({url:f.file||f.src,lang:f.label||"Unknown",label:f.label||"Unknown"});return{url:u.source||u.cf,subtitles:d}}}catch(s){}return null})}function W(n){return m(this,null,function*(){let s=[];for(let r of n)try{let t=r.serverName,o=r.dataLink,a=null,e="Auto",l={},i=t.toLowerCase();if(i.includes("zen")?(a=yield J(o),e="1080p",l={Referer:"https://zencloudz.cc/"}):i.includes("wish")||i.includes("s-wish")||i.includes("h-wish")?(a=yield V(o),l={Referer:new URL(o).origin}):i.includes("vidhide")||i.includes("s-hide")||i.includes("h-hide")?(a=yield Z(o),l={Referer:new URL(o).origin}):i.includes("doodstream")?(a=yield Y(o),l={Referer:"https://dood.li/"}):i.includes("mp4upload")?(a=yield et(o),l={Referer:"https://www.mp4upload.com/"}):i.startsWith("kumi")&&(a=yield st(o),l={Referer:new URL(o).origin}),a&&a.url){let c=a.url,u=a.subtitles||[];s.push({name:`Kuudere (${t})`,title:`${r.dataType.toUpperCase()} - Direct`,url:c,quality:e,headers:l,subtitles:u})}else s.push({name:`Kuudere (${t})`,title:`${r.dataType.toUpperCase()} - Embed`,url:o,quality:"Auto",headers:{Referer:"https://kuudere.ru/"}})}catch(t){}return s})}function nt(n){return n?n.toLowerCase().replace(/[^\w\s]/g," ").replace(/\s+/g," ").trim():""}function O(n,s){let r=nt(n).replace(/\s+/g,""),t=nt(s).replace(/\s+/g,"");if(r===t)return 1;if(r.length<2||t.length<2)return 0;let o=new Set;for(let e=0;e<r.length-1;e++)o.add(r.substring(e,e+2));let a=0;for(let e=0;e<t.length-1;e++){let l=t.substring(e,e+2);o.has(l)&&a++}return 2*a/(r.length+t.length-2)}var ot=R(require("axios"));function at(n){return m(this,null,function*(){try{let s=yield ot.default.get(`https://arm.haglund.dev/api/v2/themoviedb?id=${n}`,{timeout:5e3});if(Array.isArray(s.data)&&s.data.length>0)return s.data[0]}catch(s){console.error("[Kuudere] ARM API error:",s.message)}return null})}function Ut(n){if(!n||!n.nodes)return[];let s=n.nodes.find(e=>e&&e.data&&e.data.some(l=>l&&l.animeData));if(!s)return[];let r=s.data,t=r.find(e=>e&&e.animeData),o=r[r.indexOf(t)+1],a=[];if(Array.isArray(o))for(let e of o){let l=r[e];if(l&&typeof l=="object"){let i={};for(let[c,u]of Object.entries(l))typeof u=="number"&&r[u]!==void 0?i[c]=r[u]:i[c]=u;a.push({id:i.id,title:i.english||i.title||i.romaji||i.native,poster:i.cover||i.coverImage,year:i.year,type:String(i.type).toLowerCase().includes("movie")?"movie":"tv"})}}return a}function it(n){return m(this,null,function*(){try{let s=yield I("get",`/search/__data.json?keyword=${encodeURIComponent(n)}`),r=Ut(s.data);if(r.length===0){let t=yield I("get",`/api/search?q=${encodeURIComponent(n)}`);t.data&&t.data.results&&(r=t.data.results.map(o=>({title:o.title,id:o.id,poster:o.coverImage,type:o.details.toLowerCase().includes("movie")?"movie":"tv"})))}return r.map(t=>({name:"Kuudere",title:t.title,url:t.id,poster:t.poster,year:t.year,type:t.type}))}catch(s){return console.error("[Kuudere] Search error:",s.message),[]}})}function _t(n,s,r,t,o=null){return m(this,null,function*(){try{let a=o||(yield H(n,s));if(!a)return[];console.log(`[Kuudere] Searching for: ${a.title} (${a.year}) [${s}]`);let e=yield at(n),l=e==null?void 0:e.anilist,i=s==="movie"?"movie":"tv",c=[a.title.replace(/[^\x00-\x7F]/g," ").replace(/\s+/g," ").trim(),a.title.split(/[:\-\–\—]/)[0].trim()],u=[];for(let y of c){if(y.length<3)continue;let b=yield it(y);u=[...u,...b]}let d=[],h=new Set;for(let y of u)h.has(y.url)||(h.add(y.url),d.push(y));let f=d.filter(y=>y.type===i);if(f.length===0)return console.log(`[Kuudere] No search results matching type: ${i}`),[];let g=null;if(l&&(g=f.find(y=>y.poster&&y.poster.includes(`bx${l}`)),g&&console.log(`[Kuudere] Exact AniList match: ${l}`)),!g&&i==="tv"&&r&&parseInt(r)>1){let y=`${a.title} Season ${r}`,b=f.map(k=>_(U({},k),{score:O(k.title,y)})).sort((k,C)=>C.score-k.score);b.length>0&&b[0].score>.6&&(g=b[0])}if(!g){let y=f.map(b=>{let k=O(b.title,a.title);return b.year&&a.year&&String(b.year)===String(a.year)&&(k+=.4),_(U({},b),{score:k})}).sort((b,k)=>k.score-b.score);y.length>0&&y[0].score>.75&&(g=y[0])}if(!g)return console.log("[Kuudere] No matching anime found."),[];console.log(`[Kuudere] Found match: ${g.title} (Type: ${g.type}, Score: ${g.score?g.score.toFixed(2):"ID"})`);let A=(yield I("get",`/api/watch/${g.url}/${t}`)).data;return!A.episode_links||A.episode_links.length===0?(console.log("[Kuudere] No stream links found for this episode."),[]):yield W(A.episode_links)}catch(a){return[]}})}module.exports={getStreams:_t,search:it,extractStreams:W};
