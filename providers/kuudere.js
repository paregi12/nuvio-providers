/**
 * kuudere - Built from src/kuudere/
 * Generated: 2026-01-10T09:52:21.128Z
 */
var at=Object.create;var $=Object.defineProperty,it=Object.defineProperties,ct=Object.getOwnPropertyDescriptor,lt=Object.getOwnPropertyDescriptors,ut=Object.getOwnPropertyNames,W=Object.getOwnPropertySymbols,ft=Object.getPrototypeOf,D=Object.prototype.hasOwnProperty,dt=Object.prototype.propertyIsEnumerable;var q=(n,s,e)=>s in n?$(n,s,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[s]=e,v=(n,s)=>{for(var e in s||(s={}))D.call(s,e)&&q(n,e,s[e]);if(W)for(var e of W(s))dt.call(s,e)&&q(n,e,s[e]);return n},O=(n,s)=>it(n,lt(s));var pt=(n,s,e,t)=>{if(s&&typeof s=="object"||typeof s=="function")for(let o of ut(s))!D.call(n,o)&&o!==e&&$(n,o,{get:()=>s[o],enumerable:!(t=ct(s,o))||t.enumerable});return n};var w=(n,s,e)=>(e=n!=null?at(ft(n)):{},pt(s||!n||!n.__esModule?$(e,"default",{value:n,enumerable:!0}):e,n));var m=(n,s,e)=>new Promise((t,o)=>{var a=i=>{try{l(e.next(i))}catch(c){o(c)}},r=i=>{try{l(e.throw(i))}catch(c){o(c)}},l=i=>i.done?t(i.value):Promise.resolve(i.value).then(a,r);l((e=e.apply(n,s)).next())});var B=w(require("axios"));var _="https://kuudere.ru",g="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36";function A(t,o){return m(this,arguments,function*(n,s,e={}){let a=s.startsWith("http")?s:`${_}${s}`;try{return yield(0,B.default)(O(v({method:n,url:a},e),{headers:v({"User-Agent":g,Referer:_,"X-Requested-With":"XMLHttpRequest"},e.headers)}))}catch(r){throw console.error(`[Kuudere] Request error (${a}):`,r.message),r}})}var P=w(require("axios"));var ht="68e094699525b18a70bab2f86b1fa706";function G(n,s){return m(this,null,function*(){let t=`https://api.themoviedb.org/3/${s==="tv"||s==="series"?"tv":"movie"}/${n}?api_key=${ht}&language=en-US`;try{let a=(yield P.default.get(t)).data;return{title:a.name||a.title,year:(a.first_air_date||a.release_date||"").split("-")[0]}}catch(o){return console.error("[Kuudere] TMDB metadata error:",o.message),null}})}var C=w(require("axios")),k=w(require("crypto-js"));function U(n,s,e=new Set){if(e.has(n))return null;e.add(n);let t=s[n];if(typeof t=="number")return s[t]!==void 0?U(t,s,e):t;if(Array.isArray(t))return t.map(o=>typeof o=="number"?U(o,s,new Set(e)):o);if(t&&typeof t=="object"){let o={};for(let[a,r]of Object.entries(t))o[a]=typeof r=="number"?U(r,s,new Set(e)):r;return o}return t}function E(n,s){if(!n||typeof n!="object")return null;if(n[s])return n[s];for(let e in n){let t=E(n[e],s);if(t)return t}return null}function mt(n){let s=[],e=n.subtitle_links||[];if(Array.isArray(e))for(let t of e)t.url&&s.push({url:t.url,lang:t.language||"English",label:t.language||"English"});if(n.nodes){for(let t of n.nodes)if(t&&t.data){let o=t.data,a=o.find(r=>r&&(r.subtitles||r.tracks));if(a){let r=a.subtitles||a.tracks||[];if(typeof r=="number"&&(r=o[r]||[]),Array.isArray(r))for(let l of r){let i=U(l,o);i&&i.url&&s.push({url:i.url,lang:i.language||i.label||"English",label:i.language||i.label||"English"})}}}}return s}function X(n){return m(this,null,function*(){var s;try{let e=new URL(n),t=`${e.origin}${e.pathname}/__data.json${e.search}`,a=(yield C.default.get(t,{headers:{Referer:"https://kuudere.ru/","User-Agent":g}})).data,r=mt(a),l=(s=a.nodes)==null?void 0:s.find(x=>x&&x.data&&x.data.some(F=>F&&F.obfuscation_seed));if(!l)return{url:null,subtitles:r};let i=l.data,c=i.findIndex(x=>x&&x.obfuscation_seed),u=i[c],p=i[u.obfuscation_seed],f=k.default.SHA256(p).toString(),d={keyField:`kf_${f.substring(8,16)}`,ivField:`ivf_${f.substring(16,24)}`,tokenField:`${f.substring(48,64)}_${f.substring(56,64)}`},y=U(c,i),h=E(y,d.keyField),T=E(y,d.ivField),j=y[d.tokenField];if(!j||!h||!T)return{url:null,subtitles:r};let rt=(yield C.default.get(`${e.origin}/api/m3u8/${j}`,{headers:{Referer:n,"User-Agent":g,"X-Requested-With":"XMLHttpRequest"}})).data.video_b64,nt=k.default.enc.Base64.parse(h),st=k.default.enc.Base64.parse(T),ot=k.default.enc.Base64.parse(rt);return{url:k.default.AES.decrypt({ciphertext:ot},nt,{iv:st,mode:k.default.mode.CBC,padding:k.default.pad.Pkcs7}).toString(k.default.enc.Utf8),subtitles:r}}catch(e){return null}})}var I=w(require("axios"));function gt(n){try{let s=n.match(new RegExp("eval\\(function\\(p,a,c,k,e,d\\)\\{.*?\\}\\((.*)\\)\\)","s"));if(!s)return null;let e=s[1],t=[],o="",a=!1,r="",l=0;for(let i=0;i<e.length;i++){let c=e[i];if(c==="\\"&&a){o+=c+e[++i];continue}if((c==="'"||c==='"'||c==="`")&&(!a||r===c)){a=!a,r=a?c:"",o+=c;continue}a||(c==="("&&l++,c===")"&&l--),c===","&&!a&&l===0?(t.push(o.trim()),o=""):o+=c}if(t.push(o.trim()),t.length>=4){let i=t[0].substring(1,t[0].length-1),c=parseInt(t[1]),u=parseInt(t[2]),p=t[3].match(new RegExp(`['"](.*?)['"]`,"s"));if(!p)return null;let f=p[1].split("|"),d=function(h){return(h<c?"":d(parseInt(h/c)))+((h=h%c)>35?String.fromCharCode(h+29):h.toString(36))},y={};for(let h=0;h<f.length;h++)f[h]&&(y[d(h)]=f[h]);return i.replace(/\b\w+\b/g,h=>y[h]||h)}}catch(s){}return null}function yt(n,s){return m(this,null,function*(){if(n.includes("main.js?v=1.1.3")||n.includes("Page is loading, please wait...")){let e=new URL(s),t=["hgplaycdn.com","wishembed.com","strwish.com","dwish.pro","awish.pro","hlswish.com"];for(let o of t){if(o===e.hostname)continue;let a=`https://${o}${e.pathname}${e.search}`;try{let r=yield I.default.get(a,{headers:{Referer:"https://kuudere.ru/","User-Agent":g},timeout:3e3});if(r.data.includes("jwplayer")||r.data.includes("eval(function(p,a,c,k,e,d)"))return r.data}catch(r){}}}return n})}function z(n){return m(this,null,function*(){try{let e=(yield I.default.get(n,{headers:{Referer:"https://kuudere.ru/","User-Agent":g},timeout:5e3})).data;e=yield yt(e,n);let t=null,o=gt(e);if(o){let a=o.match(/"hls4"\s*:\s*"([^"]+)"/),r=o.match(/"hls3"\s*:\s*"([^"]+)"/),l=o.match(/"hls2"\s*:\s*"([^"]+)"/);if(t=a&&a[1]||r&&r[1]||l&&l[1],!t){let i=o.match(/file\s*:\s*"([^"]+\.(?:m3u8|txt)[^"]*)"/)||o.match(/sources\s*:\s*\[\s*{\s*file\s*:\s*"([^"]+)"/);i&&(t=i[1])}}if(!t){let a=e.match(/file\s*:\s*"([^"]+\.(?:m3u8|txt)[^"]*)"/)||e.match(/sources\s*:\s*\[\s*{\s*file\s*:\s*"([^"]+)"/);a&&(t=a[1])}return t?(t.startsWith("/")&&(t=new URL(n).origin+t),{url:t}):null}catch(s){return null}})}var H=w(require("axios"));function wt(n){let s=[];try{let e=new URL(n);for(let[t,o]of e.searchParams.entries())if(t.startsWith("caption_")){let a=t.replace("caption_","");s.push({url:o,lang:`Caption ${a}`,label:`Caption ${a}`})}}catch(e){}return s}function bt(n){try{let s=n.match(/eval\(function\(p,a,c,k,e,d\)\{.*?\}\((.*)\)\)/);if(s){let e=s[1].match(/'(.*?)',(\d+),(\d+),'(.*?)'\.split\('\|'\)/);if(e){let[t,o,a,r,l]=e;a=parseInt(a),r=parseInt(r),l=l.split("|");let i=function(c){return(c<a?"":i(parseInt(c/a)))+((c=c%a)>35?String.fromCharCode(c+29):c.toString(36))};{let c={};for(;r--;)c[i(r)]=l[r]||i(r);l=[function(u){return c[u]}],r=1}for(;r--;)l[r]&&(o=o.replace(new RegExp("\\b\\w+\\b","g"),function(c){return l[r](c)||c}));return o}}}catch(s){}return null}function J(n){return m(this,null,function*(){try{let e=(yield H.default.get(n,{headers:{Referer:"https://kuudere.ru/","User-Agent":g}})).data,t=null,o=e.match(/file\s*:\s*"([^"]+\.(?:m3u8|txt)[^"]*)"/)||e.match(/sources\s*:\s*\[\s*{\s*file\s*:\s*"([^"]+)"/);if(o)t=o[1];else{let r=bt(e);if(r){let l=r.match(/"hls4"\s*:\s*"([^"]+)"/),i=r.match(/"hls3"\s*:\s*"([^"]+)"/),c=r.match(/"hls2"\s*:\s*"([^"]+)"/);if(t=l&&l[1]||i&&i[1]||c&&c[1],!t){let u=r.match(/file\s*:\s*"([^"]+\.(?:m3u8|txt)[^"]*)"/)||r.match(/sources\s*:\s*\[\s*{\s*file\s*:\s*"([^"]+)"/);u&&(t=u[1])}}}if(!t)return null;t.startsWith("/")&&(t=new URL(n).origin+t);let a=wt(n);return{url:t,subtitles:a}}catch(s){return null}})}var M=w(require("axios"));function V(n){return m(this,null,function*(){try{let t=(yield M.default.get(n,{headers:{"User-Agent":g}})).data.match(/\/pass_md5\/([^']*)/);if(!t)return null;let o=t[1],a=`${new URL(n).origin}/pass_md5/${o}`;return{url:`${(yield M.default.get(a,{headers:{Referer:n,"User-Agent":g}})).data}${(u=>{let p="",f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let d=0;d<u;d++)p+=f.charAt(Math.floor(Math.random()*f.length));return p})(10)}?token=${o}&expiry=${Date.now()}`,subtitles:[]}}catch(s){return null}})}var Q=w(require("axios"));function kt(n){try{let s=n.match(/eval\(function\(p,a,c,k,e,d\)\{.*?\}\((.*)\)\)/);if(s){let e=s[1].match(/'(.*?)',(\d+),(\d+),'(.*?)'\.split\('\|'\)/);if(e){let[t,o,a,r,l]=e;a=parseInt(a),r=parseInt(r),l=l.split("|");let i=function(c){return(c<a?"":i(parseInt(c/a)))+((c=c%a)>35?String.fromCharCode(c+29):c.toString(36))};{let c={};for(;r--;)c[i(r)]=l[r]||i(r);l=[function(u){return c[u]}],r=1}for(;r--;)l[r]&&(o=o.replace(new RegExp("\\b\\w+\\b","g"),function(c){return l[r](c)||c}));return o}}}catch(s){}return null}function Y(n){return m(this,null,function*(){try{let e=(yield Q.default.get(n,{headers:{"User-Agent":g,Referer:"https://kuudere.ru/"}})).data,t=e.match(/src\s*:\s*"([^"]+\.mp4)"/);if(!t){let o=kt(e);o&&(t=o.match(/src\s*:\s*"([^"]+\.mp4)"/))}return t?{url:t[1],subtitles:[]}:null}catch(s){return null}})}var L=w(require("axios")),b=w(require("crypto-js"));var R=(...n)=>String.fromCharCode(...n),N=(n,s)=>n.charCodeAt(s)||0;function Rt(n){let s="10",o="",a=["7","5","1","9"];for(let p=0;p<a.length;p++)o+=R(s+a[p]);o+=R(N(n,parseInt(s)/10)),o+=o.substring(1,3),o+=R(110,109,117);let r=["3","5","7","9"];o+=R(r[3]+r[2],r[1]+r[2]);let l=Number(r[0])*1+1+r[3];o+=R(l,l);let i=Number(r[3])*parseInt(s)+Number(r[3])*1,c=r.slice().reverse().join("").substring(0,2);o+=R(i,c);let u=new Uint8Array(o.length);for(let p=0;p<o.length;p++)u[p]=o.charCodeAt(p)&255;return b.default.lib.WordArray.create(u,u.length)}function St(n,s){let e=n,t=e+"//",o=s,a=e.length*t.length,r=1,l="";for(let h=r;h<10;h++)l+=R(h+a);let i="";i=r+i+r+i+r;let c=i.length*N(o,0),u=parseInt(i)*r+e.length,p=u+4,f=N(e,r),d=f*r-2;l+=R(a,parseInt(i),c,u,p,f,d);let y=new Uint8Array(16);for(let h=0;h<16;h++)y[h]=l.charCodeAt(h)&255;return b.default.lib.WordArray.create(y,y.length)}function Z(n,s,e){return m(this,null,function*(){try{if(!n)return null;let t;if(typeof n=="string")if(/^[0-9a-fA-F]+$/.test(n))t=b.default.enc.Hex.parse(n);else return null;else t=b.default.lib.WordArray.create(new Uint8Array(n));let o=b.default.AES.decrypt({ciphertext:t},s,{iv:e,mode:b.default.mode.CBC,padding:b.default.pad.Pkcs7}),a="";try{a=o.toString(b.default.enc.Utf8)}catch(r){a=o.toString(b.default.enc.Latin1)}if(a&&(a.includes("source")||a.includes("sources")||a.includes("player"))){let r=a.substring(a.indexOf("{"),a.lastIndexOf("}")+1);return JSON.parse(r)}}catch(t){}return null})}function tt(n){return m(this,null,function*(){try{let s=new URL(n),e=s.hostname,t=s.protocol,o=s.hash.substring(1).split("&")[0];if(!o)return null;let a=Rt(t),r=St(t,e),l=yield L.default.get(`${t}//${e}/api/v1/info?id=${o}`,{headers:{"User-Agent":g,Referer:n,"X-Requested-With":"XMLHttpRequest"},timeout:5e3,responseType:"arraybuffer"}),i=yield Z(l.data,a,r),c=["kuudere.ru",e,"kuudere.to"],u=null;for(let p of c)try{let f=`${t}//${e}/api/v1/video?id=${o}&w=1920&h=1080&u=${p}`,d=yield L.default.get(f,{headers:{"User-Agent":g,Referer:n,"X-Requested-With":"XMLHttpRequest"},timeout:5e3,responseType:"arraybuffer"});if(u=yield Z(d.data,a,r),u&&(u.source||u.cf))break}catch(f){}if(u&&(u.source||u.cf)){let p=[],f=i||u;if(f.subtitles)for(let d of f.subtitles)p.push({url:d.url||d.file||d.src,lang:d.language||d.label||"Unknown",label:d.label||d.language||"Unknown"});else if(f.tracks)for(let d of f.tracks)(d.kind==="captions"||d.kind==="subtitles")&&p.push({url:d.file||d.src,lang:d.label||"Unknown",label:d.label||"Unknown"});return{url:u.source||u.cf,subtitles:p}}}catch(s){}return null})}function K(n){return m(this,null,function*(){let s=[];for(let e of n)try{let t=e.serverName,o=e.dataLink,a=null,r="Auto",l={},i=t.toLowerCase();if(i.includes("zen")?(a=yield X(o),r="1080p",l={Referer:"https://zencloudz.cc/"}):i.includes("wish")||i.includes("s-wish")||i.includes("h-wish")?(a=yield z(o),l={Referer:new URL(o).origin}):i.includes("vidhide")||i.includes("s-hide")||i.includes("h-hide")?(a=yield J(o),l={Referer:new URL(o).origin}):i.includes("doodstream")?(a=yield V(o),l={Referer:"https://dood.li/"}):i.includes("mp4upload")?(a=yield Y(o),l={Referer:"https://www.mp4upload.com/"}):i.startsWith("kumi")&&(a=yield tt(o),l={Referer:new URL(o).origin}),a&&a.url){let c=a.url,u=a.subtitles||[];s.push({name:`Kuudere (${t})`,title:`${e.dataType.toUpperCase()} - Direct`,url:c,quality:r,headers:l,subtitles:u})}else s.push({name:`Kuudere (${t})`,title:`${e.dataType.toUpperCase()} - Embed`,url:o,quality:"Auto",headers:{Referer:"https://kuudere.ru/"}})}catch(t){}return s})}function xt(n){if(!n||!n.nodes)return[];let s=n.nodes.find(r=>r&&r.data&&r.data.some(l=>l&&l.animeData));if(!s)return[];let e=s.data,t=e.find(r=>r&&r.animeData),o=e[e.indexOf(t)+1],a=[];if(Array.isArray(o))for(let r of o){let l=e[r];if(l&&typeof l=="object"){let i={};for(let[c,u]of Object.entries(l))typeof u=="number"&&e[u]!==void 0?i[c]=e[u]:i[c]=u;a.push({id:i.id,title:i.english||i.title||i.romaji||i.native,poster:i.cover||i.coverImage,year:i.year,type:String(i.type).toLowerCase().includes("movie")?"movie":"tv"})}}return a}function S(n){return n?n.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().replace(/[^\w\s]/g,"").trim():""}function et(n){return m(this,null,function*(){try{let s=yield A("get",`/search/__data.json?keyword=${encodeURIComponent(n)}`),e=xt(s.data);if(e.length===0){let t=yield A("get",`/api/search?q=${encodeURIComponent(n)}`);t.data&&t.data.results&&(e=t.data.results.map(o=>({title:o.title,id:o.id,poster:o.coverImage,type:o.details.toLowerCase().includes("movie")?"movie":"tv"})))}return e.map(t=>({name:"Kuudere",title:t.title,url:t.id,poster:t.poster,year:t.year,type:t.type}))}catch(s){return console.error("[Kuudere] Search error:",s.message),[]}})}function Ut(n,s,e,t,o=null){return m(this,null,function*(){try{let a=o||(yield G(n,s));if(!a)return[];let r=S(a.title),l=a.year;console.log(`[Kuudere] Searching for: ${a.title} (${a.year})`);let i=yield et(a.title.replace(/[^\x00-\x7F]/g,"")),c=null;if(s==="tv"&&e&&parseInt(e)>1){let f=S(`${a.title} Season ${e}`);c=i.find(d=>S(d.title)===f),c||(c=i.find(d=>S(d.title).includes(f)))}if(c||(c=i.find(f=>S(f.title)===r&&(String(f.year)===String(l)||!f.year)),c||(c=i.find(f=>S(f.title)===r)),c||(c=i.find(f=>S(f.title).includes(r)))),!c)return console.log("[Kuudere] No matching anime found."),[];console.log(`[Kuudere] Found match: ${c.title} (${c.url})`);let p=(yield A("get",`/api/watch/${c.url}/${t}`)).data;return!p.episode_links||p.episode_links.length===0?(console.log("[Kuudere] No stream links found for this episode."),[]):yield K(p.episode_links)}catch(a){return[]}})}module.exports={getStreams:Ut,search:et,extractStreams:K};
