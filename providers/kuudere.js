/**
 * kuudere - Built from src/kuudere/
 * Generated: 2026-01-10T13:54:59.645Z
 */
var ot=Object.create;var $=Object.defineProperty,at=Object.defineProperties,it=Object.getOwnPropertyDescriptor,ct=Object.getOwnPropertyDescriptors,lt=Object.getOwnPropertyNames,T=Object.getOwnPropertySymbols,ut=Object.getPrototypeOf,D=Object.prototype.hasOwnProperty,ft=Object.prototype.propertyIsEnumerable;var j=(r,n,e)=>n in r?$(r,n,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[n]=e,_=(r,n)=>{for(var e in n||(n={}))D.call(n,e)&&j(r,e,n[e]);if(T)for(var e of T(n))ft.call(n,e)&&j(r,e,n[e]);return r},B=(r,n)=>at(r,ct(n));var pt=(r,n,e,t)=>{if(n&&typeof n=="object"||typeof n=="function")for(let o of lt(n))!D.call(r,o)&&o!==e&&$(r,o,{get:()=>n[o],enumerable:!(t=it(n,o))||t.enumerable});return r};var b=(r,n,e)=>(e=r!=null?ot(ut(r)):{},pt(n||!r||!r.__esModule?$(e,"default",{value:r,enumerable:!0}):e,r));var d=(r,n,e)=>new Promise((t,o)=>{var s=i=>{try{l(e.next(i))}catch(c){o(c)}},a=i=>{try{l(e.throw(i))}catch(c){o(c)}},l=i=>i.done?t(i.value):Promise.resolve(i.value).then(s,a);l((e=e.apply(r,n)).next())});var O=b(require("axios"));var C="https://kuudere.ru",m="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36";function x(t,o){return d(this,arguments,function*(r,n,e={}){let s=n.startsWith("http")?n:`${C}${n}`;try{return yield(0,O.default)(B(_({method:r,url:s},e),{headers:_({"User-Agent":m,Referer:C,"X-Requested-With":"XMLHttpRequest"},e.headers)}))}catch(a){throw console.error(`[Kuudere] Request error (${s}):`,a.message),a}})}var dt="68e094699525b18a70bab2f86b1fa706";function P(r,n){return d(this,null,function*(){let t=`https://api.themoviedb.org/3/${n==="tv"||n==="series"?"tv":"movie"}/${r}?api_key=${dt}&language=en-US`;try{let s=(yield x("get",t)).data;return{title:s.name||s.title,year:(s.first_air_date||s.release_date||"").split("-")[0]}}catch(o){return null}})}var E=b(require("axios")),R=b(require("crypto-js"));function U(r,n,e=new Set){if(e.has(r))return null;e.add(r);let t=n[r];if(typeof t=="number")return n[t]!==void 0?U(t,n,e):t;if(Array.isArray(t))return t.map(o=>typeof o=="number"?U(o,n,new Set(e)):o);if(t&&typeof t=="object"){let o={};for(let[s,a]of Object.entries(t))o[s]=typeof a=="number"?U(a,n,new Set(e)):a;return o}return t}function I(r,n){if(!r||typeof r!="object")return null;if(r[n])return r[n];for(let e in r){let t=I(r[e],n);if(t)return t}return null}function ht(r){let n=[],e=r.subtitle_links||[];if(Array.isArray(e))for(let t of e)t.url&&n.push({url:t.url,lang:t.language||"English",label:t.language||"English"});if(r.nodes){for(let t of r.nodes)if(t&&t.data){let o=t.data,s=o.find(a=>a&&(a.subtitles||a.tracks));if(s){let a=s.subtitles||s.tracks||[];if(typeof a=="number"&&(a=o[a]||[]),Array.isArray(a))for(let l of a){let i=U(l,o);i&&i.url&&n.push({url:i.url,lang:i.language||i.label||"English",label:i.language||i.label||"English"})}}}}return n}function G(r){return d(this,null,function*(){var n;try{let e=new URL(r),t=`${e.origin}${e.pathname}/__data.json${e.search}`,s=(yield E.default.get(t,{headers:{Referer:"https://kuudere.ru/","User-Agent":m}})).data,a=ht(s),l=(n=s.nodes)==null?void 0:n.find(v=>v&&v.data&&v.data.some(F=>F&&F.obfuscation_seed));if(!l)return{url:null,subtitles:a};let i=l.data,c=i.findIndex(v=>v&&v.obfuscation_seed),p=i[c],h=i[p.obfuscation_seed],f=R.default.SHA256(h).toString(),y={keyField:`kf_${f.substring(8,16)}`,ivField:`ivf_${f.substring(16,24)}`,tokenField:`${f.substring(48,64)}_${f.substring(56,64)}`},g=U(c,i),u=I(g,y.keyField),k=I(g,y.ivField),W=g[y.tokenField];if(!W||!u||!k)return{url:null,subtitles:a};let et=(yield E.default.get(`${e.origin}/api/m3u8/${W}`,{headers:{Referer:r,"User-Agent":m,"X-Requested-With":"XMLHttpRequest"}})).data.video_b64,rt=R.default.enc.Base64.parse(u),nt=R.default.enc.Base64.parse(k),st=R.default.enc.Base64.parse(et);return{url:R.default.AES.decrypt({ciphertext:st},rt,{iv:nt,mode:R.default.mode.CBC,padding:R.default.pad.Pkcs7}).toString(R.default.enc.Utf8),subtitles:a}}catch(e){return null}})}var M=b(require("axios"));function mt(r){try{let n=r.match(new RegExp("eval\\(function\\(p,a,c,k,e,d\\)\\{.*?\\}\\((.*)\\)\\)","s"));if(!n)return null;let e=n[1],t=[],o="",s=!1,a="",l=0;for(let i=0;i<e.length;i++){let c=e[i];if(c==="\\"&&s){o+=c+e[++i];continue}if((c==="'"||c==='"'||c==="`")&&(!s||a===c)){s=!s,a=s?c:"",o+=c;continue}s||(c==="("&&l++,c===")"&&l--),c===","&&!s&&l===0?(t.push(o.trim()),o=""):o+=c}if(t.push(o.trim()),t.length>=4){let i=t[0].substring(1,t[0].length-1),c=parseInt(t[1]),p=parseInt(t[2]),h=t[3].match(new RegExp(`['"](.*?)['"]`,"s"));if(!h)return null;let f=h[1].split("|"),y=function(u){return(u<c?"":y(parseInt(u/c)))+((u=u%c)>35?String.fromCharCode(u+29):u.toString(36))},g={};for(let u=0;u<f.length;u++)f[u]&&(g[y(u)]=f[u]);return i.replace(/\b\w+\b/g,u=>g[u]||u)}}catch(n){}return null}function gt(r,n){return d(this,null,function*(){if(r.includes("main.js?v=1.1.3")||r.includes("Page is loading, please wait...")){let e=new URL(n),t=["hgplaycdn.com","wishembed.com","strwish.com","dwish.pro","awish.pro","hlswish.com"];for(let o of t){if(o===e.hostname)continue;let s=`https://${o}${e.pathname}${e.search}`;try{let a=yield M.default.get(s,{headers:{Referer:"https://kuudere.ru/","User-Agent":m},timeout:3e3});if(a.data.includes("jwplayer")||a.data.includes("eval(function(p,a,c,k,e,d)"))return a.data}catch(a){}}}return r})}function z(r){return d(this,null,function*(){try{let e=(yield M.default.get(r,{headers:{Referer:"https://kuudere.ru/","User-Agent":m},timeout:5e3})).data;e=yield gt(e,r);let t=null,o=mt(e);if(o){let s=o.match(/"hls4"\s*:\s*"([^"]+)"/),a=o.match(/"hls3"\s*:\s*"([^"]+)"/),l=o.match(/"hls2"\s*:\s*"([^"]+)"/);if(t=s&&s[1]||a&&a[1]||l&&l[1],!t){let i=o.match(/file\s*:\s*"([^"]+\.(?:m3u8|txt)[^"]*)"/)||o.match(/sources\s*:\s*\[\s*{\s*file\s*:\s*"([^"]+)"/);i&&(t=i[1])}}if(!t){let s=e.match(/file\s*:\s*"([^"]+\.(?:m3u8|txt)[^"]*)"/)||e.match(/sources\s*:\s*\[\s*{\s*file\s*:\s*"([^"]+)"/);s&&(t=s[1])}return t?(t.startsWith("/")&&(t=new URL(r).origin+t),{url:t}):null}catch(n){return null}})}var H=b(require("axios"));function yt(r){let n=[];try{let e=new URL(r);for(let[t,o]of e.searchParams.entries())if(t.startsWith("caption_")){let s=t.replace("caption_","");n.push({url:o,lang:`Caption ${s}`,label:`Caption ${s}`})}}catch(e){}return n}function wt(r){try{let n=r.match(/eval\(function\(p,a,c,k,e,d\)\{.*?\}\((.*)\)\)/);if(n){let e=n[1].match(/'(.*?)',(\d+),(\d+),'(.*?)'\.split\('\|'\)/);if(e){let[t,o,s,a,l]=e;s=parseInt(s),a=parseInt(a),l=l.split("|");let i=function(c){return(c<s?"":i(parseInt(c/s)))+((c=c%s)>35?String.fromCharCode(c+29):c.toString(36))};{let c={};for(;a--;)c[i(a)]=l[a]||i(a);l=[function(p){return c[p]}],a=1}for(;a--;)l[a]&&(o=o.replace(new RegExp("\\b\\w+\\b","g"),function(c){return l[a](c)||c}));return o}}}catch(n){}return null}function X(r){return d(this,null,function*(){try{let e=(yield H.default.get(r,{headers:{Referer:"https://kuudere.ru/","User-Agent":m}})).data,t=null,o=e.match(/file\s*:\s*"([^"]+\.(?:m3u8|txt)[^"]*)"/)||e.match(/sources\s*:\s*\[\s*{\s*file\s*:\s*"([^"]+)"/);if(o)t=o[1];else{let a=wt(e);if(a){let l=a.match(/"hls4"\s*:\s*"([^"]+)"/),i=a.match(/"hls3"\s*:\s*"([^"]+)"/),c=a.match(/"hls2"\s*:\s*"([^"]+)"/);if(t=l&&l[1]||i&&i[1]||c&&c[1],!t){let p=a.match(/file\s*:\s*"([^"]+\.(?:m3u8|txt)[^"]*)"/)||a.match(/sources\s*:\s*\[\s*{\s*file\s*:\s*"([^"]+)"/);p&&(t=p[1])}}}if(!t)return null;t.startsWith("/")&&(t=new URL(r).origin+t);let s=yt(r);return{url:t,subtitles:s}}catch(n){return null}})}var L=b(require("axios"));function V(r){return d(this,null,function*(){try{let t=(yield L.default.get(r,{headers:{"User-Agent":m}})).data.match(/\/pass_md5\/([^']*)/);if(!t)return null;let o=t[1],s=`${new URL(r).origin}/pass_md5/${o}`;return{url:`${(yield L.default.get(s,{headers:{Referer:r,"User-Agent":m}})).data}${(p=>{let h="",f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let y=0;y<p;y++)h+=f.charAt(Math.floor(Math.random()*f.length));return h})(10)}?token=${o}&expiry=${Date.now()}`,subtitles:[]}}catch(n){return null}})}var J=b(require("axios"));function bt(r){try{let n=r.match(/eval\(function\(p,a,c,k,e,d\)\{.*?\}\((.*)\)\)/);if(n){let e=n[1].match(/'(.*?)',(\d+),(\d+),'(.*?)'\.split\('\|'\)/);if(e){let[t,o,s,a,l]=e;s=parseInt(s),a=parseInt(a),l=l.split("|");let i=function(c){return(c<s?"":i(parseInt(c/s)))+((c=c%s)>35?String.fromCharCode(c+29):c.toString(36))};{let c={};for(;a--;)c[i(a)]=l[a]||i(a);l=[function(p){return c[p]}],a=1}for(;a--;)l[a]&&(o=o.replace(new RegExp("\\b\\w+\\b","g"),function(c){return l[a](c)||c}));return o}}}catch(n){}return null}function Q(r){return d(this,null,function*(){try{let e=(yield J.default.get(r,{headers:{"User-Agent":m,Referer:"https://kuudere.ru/"}})).data,t=e.match(/src\s*:\s*"([^"]+\.mp4)"/);if(!t){let o=bt(e);o&&(t=o.match(/src\s*:\s*"([^"]+\.mp4)"/))}return t?{url:t[1],subtitles:[]}:null}catch(n){return null}})}var Z=b(require("axios")),w=b(require("crypto-js"));var S=(...r)=>String.fromCharCode(...r),N=(r,n)=>r.charCodeAt(n)||0;function Rt(r){let n=r,e="10",t=110,o=1,s="",a=["7","5","1","9"];for(let f=0;f<a.length;f++)s+=S(e+a[f]);s+=S(N(n,parseInt(e)/10)),s+=s.substring(1,3),s+=S(t,t-1,t+7);let l=["3","5","7","9"];s+=S(l[3]+l[2],l[1]+l[2]);let i=Number(l[0])*o+o+l[3];s+=S(i,i);let c=Number(l[3])*parseInt(e)+Number(l[3])*o;s+=S(c,"97");let h=new Uint8Array(s.length);for(let f=0;f<s.length;f++)h[f]=s.charCodeAt(f)&255;return w.default.lib.WordArray.create(h,h.length)}function kt(r,n){let e=r,t=e+"//",o=n,s=e.length*t.length,a=1,l="";for(let u=a;u<10;u++)l+=S(u+s);let i="111",c=i.length*N(o,0),p=parseInt(i)*a+e.length,h=p+4,f=N(e,a),y=f*a-2;l+=S(s,parseInt(i),c,p,h,f,y);let g=new Uint8Array(16);for(let u=0;u<16;u++)g[u]=l.charCodeAt(u)&255;return w.default.lib.WordArray.create(g,g.length)}function St(r,n,e){return d(this,null,function*(){try{if(!r)return null;let t;typeof r=="string"?t=w.default.enc.Hex.parse(r):t=w.default.lib.WordArray.create(new Uint8Array(r));let o=w.default.AES.decrypt({ciphertext:t},n,{iv:e,mode:w.default.mode.CBC,padding:w.default.pad.Pkcs7}),s=o.toString(w.default.enc.Utf8);return s||(s=o.toString(w.default.enc.Latin1)),JSON.parse(s)}catch(t){return null}})}function Y(r){return d(this,null,function*(){try{let n=new URL(r),e=n.hostname,t=n.protocol,o=n.hash.substring(1).split("&")[0];if(!o)return null;let s=Rt(t),a=kt(t,e),l=`${t}//${e}/api/v1/video?id=${o}&w=1920&h=1080&u=kuudere.ru`,i=yield Z.default.get(l,{headers:{"User-Agent":m,Referer:r,"X-Requested-With":"XMLHttpRequest"},responseType:"arraybuffer"}),c=yield St(i.data,s,a);if(c&&(c.source||c.cf))return{url:c.source||c.cf,subtitles:c.subtitles||[]}}catch(n){}return null})}function tt(r){return d(this,null,function*(){let n=[];for(let e of r)try{let t=e.serverName,o=e.dataLink,s=null,a="Auto",l={},i=t.toLowerCase();if(i.includes("zen")?(s=yield G(o),a="1080p",l={Referer:"https://zencloudz.cc/"}):i.includes("wish")||i.includes("s-wish")||i.includes("h-wish")?(s=yield z(o),l={Referer:new URL(o).origin}):i.includes("vidhide")||i.includes("s-hide")||i.includes("h-hide")?(s=yield X(o),l={Referer:new URL(o).origin}):i.includes("doodstream")?(s=yield V(o),l={Referer:"https://dood.li/"}):i.includes("mp4upload")?(s=yield Q(o),l={Referer:"https://www.mp4upload.com/"}):i.startsWith("kumi")&&(s=yield Y(o),l={Referer:new URL(o).origin}),s&&s.url){let c=s.url,p=s.subtitles||[];n.push({name:`Kuudere (${t})`,title:`${e.dataType.toUpperCase()} - Direct`,url:c,quality:a,headers:l,subtitles:p})}else n.push({name:`Kuudere (${t})`,title:`${e.dataType.toUpperCase()} - Embed`,url:o,quality:"Auto",headers:{Referer:"https://kuudere.ru/"}})}catch(t){}return n})}function xt(r){if(!r||!r.nodes)return[];let n=r.nodes.find(a=>a&&a.data&&a.data.some(l=>l&&l.animeData));if(!n)return[];let e=n.data,t=e.find(a=>a&&a.animeData),o=e[e.indexOf(t)+1],s=[];if(Array.isArray(o))for(let a of o){let l=e[a];if(l&&typeof l=="object"){let i={};for(let[c,p]of Object.entries(l))typeof p=="number"&&e[p]!==void 0?i[c]=e[p]:i[c]=p;s.push({id:i.id,title:i.english||i.title||i.romaji||i.native,poster:i.cover||i.coverImage,year:i.year,type:String(i.type).toLowerCase().includes("movie")?"movie":"tv"})}}return s}function q(r){return d(this,null,function*(){try{let n=yield x("get",`/search/__data.json?keyword=${encodeURIComponent(r)}`),e=xt(n.data);if(e.length===0){let t=yield x("get",`/api/search?q=${encodeURIComponent(r)}`);t.data&&t.data.results&&(e=t.data.results.map(o=>({title:o.title,id:o.id,poster:o.coverImage,type:o.details.toLowerCase().includes("movie")?"movie":"tv"})))}return e.map(t=>({name:"Kuudere",title:t.title,url:t.id,poster:t.poster,year:t.year,type:t.type}))}catch(n){return console.error("[Kuudere] Search error:",n.message),[]}})}function A(r){return r?r.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().replace(/[^\w\s]/g," ").replace(/\s+/g," ").trim():""}function K(r,n){let e=A(r),t=A(n);return e.includes(t)||t.includes(e)}function vt(r,n,e,t,o=null){return d(this,null,function*(){try{let s=o||(yield P(r,n));if(!s)return[];console.log(`[Kuudere] Searching for: ${s.title} (${s.year})`);let a=n==="movie"?"movie":"tv",l=[s.title.replace(/[^\x00-\x7F]/g,"").replace(/\s+/g," ").trim(),s.title.split(/[:\-\–\—]/)[0].trim()],i=[];for(let u of l){if(u.length<3)continue;let k=yield q(u);i=[...i,...k]}let c=[],p=new Set;for(let u of i)p.has(u.url)||(p.add(u.url),c.push(u));let h=c.filter(u=>u.type===a),f=null;if(a==="tv"&&e&&parseInt(e)>1){let u=A(`${s.title} Season ${e}`);f=h.find(k=>A(k.title)===u),f||(f=h.find(k=>A(k.title).includes(u)))}if(f||(f=h.find(u=>K(u.title,s.title)&&(String(u.year)===String(s.year)||!u.year))),f||(f=h.find(u=>K(u.title,s.title))),!f)return console.log("[Kuudere] No matching anime found."),[];console.log(`[Kuudere] Found match: ${f.title} (${f.url})`);let g=(yield x("get",`/api/watch/${f.url}/${t||1}`)).data;return!g.episode_links||g.episode_links.length===0?(console.log("[Kuudere] No stream links found for this episode."),[]):yield tt(g.episode_links)}catch(s){return[]}})}module.exports={getStreams:vt,search:q};
