/**
 * kuudere - Built from src/kuudere/
 * Generated: 2026-01-10T11:22:15.977Z
 */
var at=Object.create;var v=Object.defineProperty,it=Object.defineProperties,ct=Object.getOwnPropertyDescriptor,lt=Object.getOwnPropertyDescriptors,ut=Object.getOwnPropertyNames,W=Object.getOwnPropertySymbols,ft=Object.getPrototypeOf,D=Object.prototype.hasOwnProperty,pt=Object.prototype.propertyIsEnumerable;var O=(r,n,e)=>n in r?v(r,n,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[n]=e,_=(r,n)=>{for(var e in n||(n={}))D.call(n,e)&&O(r,e,n[e]);if(W)for(var e of W(n))pt.call(n,e)&&O(r,e,n[e]);return r},B=(r,n)=>it(r,lt(n));var dt=(r,n,e,t)=>{if(n&&typeof n=="object"||typeof n=="function")for(let o of ut(n))!D.call(r,o)&&o!==e&&v(r,o,{get:()=>n[o],enumerable:!(t=ct(n,o))||t.enumerable});return r};var b=(r,n,e)=>(e=r!=null?at(ft(r)):{},dt(n||!r||!r.__esModule?v(e,"default",{value:r,enumerable:!0}):e,r));var m=(r,n,e)=>new Promise((t,o)=>{var a=i=>{try{l(e.next(i))}catch(c){o(c)}},s=i=>{try{l(e.throw(i))}catch(c){o(c)}},l=i=>i.done?t(i.value):Promise.resolve(i.value).then(a,s);l((e=e.apply(r,n)).next())});var P=b(require("axios"));var C="https://kuudere.ru",g="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36";function x(t,o){return m(this,arguments,function*(r,n,e={}){let a=n.startsWith("http")?n:`${C}${n}`;try{return yield(0,P.default)(B(_({method:r,url:a},e),{headers:_({"User-Agent":g,Referer:C,"X-Requested-With":"XMLHttpRequest"},e.headers)}))}catch(s){throw console.error(`[Kuudere] Request error (${a}):`,s.message),s}})}var ht="68e094699525b18a70bab2f86b1fa706";function G(r,n){return m(this,null,function*(){let t=`https://api.themoviedb.org/3/${n==="tv"||n==="series"?"tv":"movie"}/${r}?api_key=${ht}&language=en-US`;try{let a=(yield x("get",t)).data;return{title:a.name||a.title,year:(a.first_air_date||a.release_date||"").split("-")[0]}}catch(o){return null}})}var E=b(require("axios")),k=b(require("crypto-js"));function $(r,n,e=new Set){if(e.has(r))return null;e.add(r);let t=n[r];if(typeof t=="number")return n[t]!==void 0?$(t,n,e):t;if(Array.isArray(t))return t.map(o=>typeof o=="number"?$(o,n,new Set(e)):o);if(t&&typeof t=="object"){let o={};for(let[a,s]of Object.entries(t))o[a]=typeof s=="number"?$(s,n,new Set(e)):s;return o}return t}function I(r,n){if(!r||typeof r!="object")return null;if(r[n])return r[n];for(let e in r){let t=I(r[e],n);if(t)return t}return null}function mt(r){let n=[],e=r.subtitle_links||[];if(Array.isArray(e))for(let t of e)t.url&&n.push({url:t.url,lang:t.language||"English",label:t.language||"English"});if(r.nodes){for(let t of r.nodes)if(t&&t.data){let o=t.data,a=o.find(s=>s&&(s.subtitles||s.tracks));if(a){let s=a.subtitles||a.tracks||[];if(typeof s=="number"&&(s=o[s]||[]),Array.isArray(s))for(let l of s){let i=$(l,o);i&&i.url&&n.push({url:i.url,lang:i.language||i.label||"English",label:i.language||i.label||"English"})}}}}return n}function z(r){return m(this,null,function*(){var n;try{let e=new URL(r),t=`${e.origin}${e.pathname}/__data.json${e.search}`,a=(yield E.default.get(t,{headers:{Referer:"https://kuudere.ru/","User-Agent":g}})).data,s=mt(a),l=(n=a.nodes)==null?void 0:n.find(U=>U&&U.data&&U.data.some(T=>T&&T.obfuscation_seed));if(!l)return{url:null,subtitles:s};let i=l.data,c=i.findIndex(U=>U&&U.obfuscation_seed),f=i[c],d=i[f.obfuscation_seed],p=k.default.SHA256(d).toString(),h={keyField:`kf_${p.substring(8,16)}`,ivField:`ivf_${p.substring(16,24)}`,tokenField:`${p.substring(48,64)}_${p.substring(56,64)}`},y=$(c,i),u=I(y,h.keyField),R=I(y,h.ivField),F=y[h.tokenField];if(!F||!u||!R)return{url:null,subtitles:s};let rt=(yield E.default.get(`${e.origin}/api/m3u8/${F}`,{headers:{Referer:r,"User-Agent":g,"X-Requested-With":"XMLHttpRequest"}})).data.video_b64,nt=k.default.enc.Base64.parse(u),st=k.default.enc.Base64.parse(R),ot=k.default.enc.Base64.parse(rt);return{url:k.default.AES.decrypt({ciphertext:ot},nt,{iv:st,mode:k.default.mode.CBC,padding:k.default.pad.Pkcs7}).toString(k.default.enc.Utf8),subtitles:s}}catch(e){return null}})}var M=b(require("axios"));function gt(r){try{let n=r.match(new RegExp("eval\\(function\\(p,a,c,k,e,d\\)\\{.*?\\}\\((.*)\\)\\)","s"));if(!n)return null;let e=n[1],t=[],o="",a=!1,s="",l=0;for(let i=0;i<e.length;i++){let c=e[i];if(c==="\\"&&a){o+=c+e[++i];continue}if((c==="'"||c==='"'||c==="`")&&(!a||s===c)){a=!a,s=a?c:"",o+=c;continue}a||(c==="("&&l++,c===")"&&l--),c===","&&!a&&l===0?(t.push(o.trim()),o=""):o+=c}if(t.push(o.trim()),t.length>=4){let i=t[0].substring(1,t[0].length-1),c=parseInt(t[1]),f=parseInt(t[2]),d=t[3].match(new RegExp(`['"](.*?)['"]`,"s"));if(!d)return null;let p=d[1].split("|"),h=function(u){return(u<c?"":h(parseInt(u/c)))+((u=u%c)>35?String.fromCharCode(u+29):u.toString(36))},y={};for(let u=0;u<p.length;u++)p[u]&&(y[h(u)]=p[u]);return i.replace(/\b\w+\b/g,u=>y[u]||u)}}catch(n){}return null}function yt(r,n){return m(this,null,function*(){if(r.includes("main.js?v=1.1.3")||r.includes("Page is loading, please wait...")){let e=new URL(n),t=["hgplaycdn.com","wishembed.com","strwish.com","dwish.pro","awish.pro","hlswish.com"];for(let o of t){if(o===e.hostname)continue;let a=`https://${o}${e.pathname}${e.search}`;try{let s=yield M.default.get(a,{headers:{Referer:"https://kuudere.ru/","User-Agent":g},timeout:3e3});if(s.data.includes("jwplayer")||s.data.includes("eval(function(p,a,c,k,e,d)"))return s.data}catch(s){}}}return r})}function X(r){return m(this,null,function*(){try{let e=(yield M.default.get(r,{headers:{Referer:"https://kuudere.ru/","User-Agent":g},timeout:5e3})).data;e=yield yt(e,r);let t=null,o=gt(e);if(o){let a=o.match(/"hls4"\s*:\s*"([^"]+)"/),s=o.match(/"hls3"\s*:\s*"([^"]+)"/),l=o.match(/"hls2"\s*:\s*"([^"]+)"/);if(t=a&&a[1]||s&&s[1]||l&&l[1],!t){let i=o.match(/file\s*:\s*"([^"]+\.(?:m3u8|txt)[^"]*)"/)||o.match(/sources\s*:\s*\[\s*{\s*file\s*:\s*"([^"]+)"/);i&&(t=i[1])}}if(!t){let a=e.match(/file\s*:\s*"([^"]+\.(?:m3u8|txt)[^"]*)"/)||e.match(/sources\s*:\s*\[\s*{\s*file\s*:\s*"([^"]+)"/);a&&(t=a[1])}return t?(t.startsWith("/")&&(t=new URL(r).origin+t),{url:t}):null}catch(n){return null}})}var H=b(require("axios"));function wt(r){let n=[];try{let e=new URL(r);for(let[t,o]of e.searchParams.entries())if(t.startsWith("caption_")){let a=t.replace("caption_","");n.push({url:o,lang:`Caption ${a}`,label:`Caption ${a}`})}}catch(e){}return n}function bt(r){try{let n=r.match(/eval\(function\(p,a,c,k,e,d\)\{.*?\}\((.*)\)\)/);if(n){let e=n[1].match(/'(.*?)',(\d+),(\d+),'(.*?)'\.split\('\|'\)/);if(e){let[t,o,a,s,l]=e;a=parseInt(a),s=parseInt(s),l=l.split("|");let i=function(c){return(c<a?"":i(parseInt(c/a)))+((c=c%a)>35?String.fromCharCode(c+29):c.toString(36))};{let c={};for(;s--;)c[i(s)]=l[s]||i(s);l=[function(f){return c[f]}],s=1}for(;s--;)l[s]&&(o=o.replace(new RegExp("\\b\\w+\\b","g"),function(c){return l[s](c)||c}));return o}}}catch(n){}return null}function J(r){return m(this,null,function*(){try{let e=(yield H.default.get(r,{headers:{Referer:"https://kuudere.ru/","User-Agent":g}})).data,t=null,o=e.match(/file\s*:\s*"([^"]+\.(?:m3u8|txt)[^"]*)"/)||e.match(/sources\s*:\s*\[\s*{\s*file\s*:\s*"([^"]+)"/);if(o)t=o[1];else{let s=bt(e);if(s){let l=s.match(/"hls4"\s*:\s*"([^"]+)"/),i=s.match(/"hls3"\s*:\s*"([^"]+)"/),c=s.match(/"hls2"\s*:\s*"([^"]+)"/);if(t=l&&l[1]||i&&i[1]||c&&c[1],!t){let f=s.match(/file\s*:\s*"([^"]+\.(?:m3u8|txt)[^"]*)"/)||s.match(/sources\s*:\s*\[\s*{\s*file\s*:\s*"([^"]+)"/);f&&(t=f[1])}}}if(!t)return null;t.startsWith("/")&&(t=new URL(r).origin+t);let a=wt(r);return{url:t,subtitles:a}}catch(n){return null}})}var L=b(require("axios"));function V(r){return m(this,null,function*(){try{let t=(yield L.default.get(r,{headers:{"User-Agent":g}})).data.match(/\/pass_md5\/([^']*)/);if(!t)return null;let o=t[1],a=`${new URL(r).origin}/pass_md5/${o}`;return{url:`${(yield L.default.get(a,{headers:{Referer:r,"User-Agent":g}})).data}${(f=>{let d="",p="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let h=0;h<f;h++)d+=p.charAt(Math.floor(Math.random()*p.length));return d})(10)}?token=${o}&expiry=${Date.now()}`,subtitles:[]}}catch(n){return null}})}var Q=b(require("axios"));function kt(r){try{let n=r.match(/eval\(function\(p,a,c,k,e,d\)\{.*?\}\((.*)\)\)/);if(n){let e=n[1].match(/'(.*?)',(\d+),(\d+),'(.*?)'\.split\('\|'\)/);if(e){let[t,o,a,s,l]=e;a=parseInt(a),s=parseInt(s),l=l.split("|");let i=function(c){return(c<a?"":i(parseInt(c/a)))+((c=c%a)>35?String.fromCharCode(c+29):c.toString(36))};{let c={};for(;s--;)c[i(s)]=l[s]||i(s);l=[function(f){return c[f]}],s=1}for(;s--;)l[s]&&(o=o.replace(new RegExp("\\b\\w+\\b","g"),function(c){return l[s](c)||c}));return o}}}catch(n){}return null}function Z(r){return m(this,null,function*(){try{let e=(yield Q.default.get(r,{headers:{"User-Agent":g,Referer:"https://kuudere.ru/"}})).data,t=e.match(/src\s*:\s*"([^"]+\.mp4)"/);if(!t){let o=kt(e);o&&(t=o.match(/src\s*:\s*"([^"]+\.mp4)"/))}return t?{url:t[1],subtitles:[]}:null}catch(n){return null}})}var N=b(require("axios")),w=b(require("crypto-js"));var S=(...r)=>String.fromCharCode(...r),q=(r,n)=>r.charCodeAt(n)||0;function Rt(r){let n="10",o="",a=["7","5","1","9"];for(let d=0;d<a.length;d++)o+=S(n+a[d]);o+=S(q(r,parseInt(n)/10)),o+=o.substring(1,3),o+=S(110,109,117);let s=["3","5","7","9"];o+=S(s[3]+s[2],s[1]+s[2]);let l=Number(s[0])*1+1+s[3];o+=S(l,l);let i=Number(s[3])*parseInt(n)+Number(s[3])*1,c=s.slice().reverse().join("").substring(0,2);o+=S(i,c);let f=new Uint8Array(o.length);for(let d=0;d<o.length;d++)f[d]=o.charCodeAt(d)&255;return w.default.lib.WordArray.create(f,f.length)}function St(r,n){let e=r,t=e+"//",o=n,a=e.length*t.length,s=1,l="";for(let u=s;u<10;u++)l+=S(u+a);let i="";i=s+i+s+i+s;let c=i.length*q(o,0),f=parseInt(i)*s+e.length,d=f+4,p=q(e,s),h=p*s-2;l+=S(a,parseInt(i),c,f,d,p,h);let y=new Uint8Array(16);for(let u=0;u<16;u++)y[u]=l.charCodeAt(u)&255;return w.default.lib.WordArray.create(y,y.length)}function Y(r,n,e){return m(this,null,function*(){try{if(!r)return null;let t;if(typeof r=="string")if(/^[0-9a-fA-F]+$/.test(r))t=w.default.enc.Hex.parse(r);else return null;else t=w.default.lib.WordArray.create(new Uint8Array(r));let o=w.default.AES.decrypt({ciphertext:t},n,{iv:e,mode:w.default.mode.CBC,padding:w.default.pad.Pkcs7}),a="";try{a=o.toString(w.default.enc.Utf8)}catch(s){a=o.toString(w.default.enc.Latin1)}if(a&&(a.includes("source")||a.includes("sources")||a.includes("player"))){let s=a.substring(a.indexOf("{"),a.lastIndexOf("}")+1);return JSON.parse(s)}}catch(t){}return null})}function tt(r){return m(this,null,function*(){try{let n=new URL(r),e=n.hostname,t=n.protocol,o=n.hash.substring(1).split("&")[0];if(!o)return null;let a=Rt(t),s=St(t,e),l=yield N.default.get(`${t}//${e}/api/v1/info?id=${o}`,{headers:{"User-Agent":g,Referer:r,"X-Requested-With":"XMLHttpRequest"},timeout:5e3,responseType:"arraybuffer"}),i=yield Y(l.data,a,s),c=["kuudere.ru",e,"kuudere.to"],f=null;for(let d of c)try{let p=`${t}//${e}/api/v1/video?id=${o}&w=1920&h=1080&u=${d}`,h=yield N.default.get(p,{headers:{"User-Agent":g,Referer:r,"X-Requested-With":"XMLHttpRequest"},timeout:5e3,responseType:"arraybuffer"});if(f=yield Y(h.data,a,s),f&&(f.source||f.cf))break}catch(p){}if(f&&(f.source||f.cf)){let d=[],p=i||f;if(p.subtitles)for(let h of p.subtitles)d.push({url:h.url||h.file||h.src,lang:h.language||h.label||"Unknown",label:h.label||h.language||"Unknown"});else if(p.tracks)for(let h of p.tracks)(h.kind==="captions"||h.kind==="subtitles")&&d.push({url:h.file||h.src,lang:h.label||"Unknown",label:h.label||"Unknown"});return{url:f.source||f.cf,subtitles:d}}}catch(n){}return null})}function et(r){return m(this,null,function*(){let n=[];for(let e of r)try{let t=e.serverName,o=e.dataLink,a=null,s="Auto",l={},i=t.toLowerCase();if(i.includes("zen")?(a=yield z(o),s="1080p",l={Referer:"https://zencloudz.cc/"}):i.includes("wish")||i.includes("s-wish")||i.includes("h-wish")?(a=yield X(o),l={Referer:new URL(o).origin}):i.includes("vidhide")||i.includes("s-hide")||i.includes("h-hide")?(a=yield J(o),l={Referer:new URL(o).origin}):i.includes("doodstream")?(a=yield V(o),l={Referer:"https://dood.li/"}):i.includes("mp4upload")?(a=yield Z(o),l={Referer:"https://www.mp4upload.com/"}):i.startsWith("kumi")&&(a=yield tt(o),l={Referer:new URL(o).origin}),a&&a.url){let c=a.url,f=a.subtitles||[];n.push({name:`Kuudere (${t})`,title:`${e.dataType.toUpperCase()} - Direct`,url:c,quality:s,headers:l,subtitles:f})}else n.push({name:`Kuudere (${t})`,title:`${e.dataType.toUpperCase()} - Embed`,url:o,quality:"Auto",headers:{Referer:"https://kuudere.ru/"}})}catch(t){}return n})}function xt(r){if(!r||!r.nodes)return[];let n=r.nodes.find(s=>s&&s.data&&s.data.some(l=>l&&l.animeData));if(!n)return[];let e=n.data,t=e.find(s=>s&&s.animeData),o=e[e.indexOf(t)+1],a=[];if(Array.isArray(o))for(let s of o){let l=e[s];if(l&&typeof l=="object"){let i={};for(let[c,f]of Object.entries(l))typeof f=="number"&&e[f]!==void 0?i[c]=e[f]:i[c]=f;a.push({id:i.id,title:i.english||i.title||i.romaji||i.native,poster:i.cover||i.coverImage,year:i.year,type:String(i.type).toLowerCase().includes("movie")?"movie":"tv"})}}return a}function K(r){return m(this,null,function*(){try{let n=yield x("get",`/search/__data.json?keyword=${encodeURIComponent(r)}`),e=xt(n.data);if(e.length===0){let t=yield x("get",`/api/search?q=${encodeURIComponent(r)}`);t.data&&t.data.results&&(e=t.data.results.map(o=>({title:o.title,id:o.id,poster:o.coverImage,type:o.details.toLowerCase().includes("movie")?"movie":"tv"})))}return e.map(t=>({name:"Kuudere",title:t.title,url:t.id,poster:t.poster,year:t.year,type:t.type}))}catch(n){return console.error("[Kuudere] Search error:",n.message),[]}})}function A(r){return r?r.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().replace(/[^\w\s]/g," ").replace(/\s+/g," ").trim():""}function j(r,n){let e=A(r),t=A(n);return e.includes(t)||t.includes(e)}function Ut(r,n,e,t,o=null){return m(this,null,function*(){try{let a=o||(yield G(r,n));if(!a)return[];console.log(`[Kuudere] Searching for: ${a.title} (${a.year})`);let s=n==="movie"?"movie":"tv",l=[a.title.replace(/[^\x00-\x7F]/g,"").replace(/\s+/g," ").trim(),a.title.split(/[:\-\–\—]/)[0].trim()],i=[];for(let u of l){if(u.length<3)continue;let R=yield K(u);i=[...i,...R]}let c=[],f=new Set;for(let u of i)f.has(u.url)||(f.add(u.url),c.push(u));let d=c.filter(u=>u.type===s),p=null;if(s==="tv"&&e&&parseInt(e)>1){let u=A(`${a.title} Season ${e}`);p=d.find(R=>A(R.title)===u),p||(p=d.find(R=>A(R.title).includes(u)))}if(p||(p=d.find(u=>j(u.title,a.title)&&(String(u.year)===String(a.year)||!u.year))),p||(p=d.find(u=>j(u.title,a.title))),!p)return console.log("[Kuudere] No matching anime found."),[];console.log(`[Kuudere] Found match: ${p.title} (${p.url})`);let y=(yield x("get",`/api/watch/${p.url}/${t||1}`)).data;return!y.episode_links||y.episode_links.length===0?(console.log("[Kuudere] No stream links found for this episode."),[]):yield et(y.episode_links)}catch(a){return[]}})}module.exports={getStreams:Ut,search:K};
