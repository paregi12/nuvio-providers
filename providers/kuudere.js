/**
 * kuudere - Built from src/kuudere/
 * Generated: 2026-01-10T06:39:59.739Z
 */
var ie=Object.create;var C=Object.defineProperty,ce=Object.defineProperties,ue=Object.getOwnPropertyDescriptor,le=Object.getOwnPropertyDescriptors,fe=Object.getOwnPropertyNames,q=Object.getOwnPropertySymbols,de=Object.getPrototypeOf,O=Object.prototype.hasOwnProperty,pe=Object.prototype.propertyIsEnumerable;var F=(n,r,t)=>r in n?C(n,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[r]=t,E=(n,r)=>{for(var t in r||(r={}))O.call(r,t)&&F(n,t,r[t]);if(q)for(var t of q(r))pe.call(r,t)&&F(n,t,r[t]);return n},P=(n,r)=>ce(n,le(r));var he=(n,r,t,e)=>{if(r&&typeof r=="object"||typeof r=="function")for(let s of fe(r))!O.call(n,s)&&s!==t&&C(n,s,{get:()=>r[s],enumerable:!(e=ue(r,s))||e.enumerable});return n};var b=(n,r,t)=>(t=n!=null?ie(de(n)):{},he(r||!n||!n.__esModule?C(t,"default",{value:n,enumerable:!0}):t,n));var p=(n,r,t)=>new Promise((e,s)=>{var o=i=>{try{u(t.next(i))}catch(c){s(c)}},a=i=>{try{u(t.throw(i))}catch(c){s(c)}},u=i=>i.done?e(i.value):Promise.resolve(i.value).then(o,a);u((t=t.apply(n,r)).next())});var j=b(require("axios"));var M="https://kuudere.ru",m="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36";function _(e,s){return p(this,arguments,function*(n,r,t={}){let o=r.startsWith("http")?r:`${M}${r}`;try{return yield(0,j.default)(P(E({method:n,url:o},t),{headers:E({"User-Agent":m,Referer:M,"X-Requested-With":"XMLHttpRequest"},t.headers)}))}catch(a){throw console.error(`[Kuudere] Request error (${o}):`,a.message),a}})}var B=b(require("axios"));var me="68e094699525b18a70bab2f86b1fa706";function H(n,r){return p(this,null,function*(){let e=`https://api.themoviedb.org/3/${r==="tv"||r==="series"?"tv":"movie"}/${n}?api_key=${me}&language=en-US`;try{let o=(yield B.default.get(e)).data;return{title:o.name||o.title,year:(o.first_air_date||o.release_date||"").split("-")[0]}}catch(s){return console.error("[Kuudere] TMDB metadata error:",s.message),null}})}var I=b(require("axios")),S=b(require("crypto-js"));function A(n,r,t=new Set){if(t.has(n))return null;t.add(n);let e=r[n];if(typeof e=="number")return r[e]!==void 0?A(e,r,t):e;if(Array.isArray(e))return e.map(s=>typeof s=="number"?A(s,r,new Set(t)):s);if(e&&typeof e=="object"){let s={};for(let[o,a]of Object.entries(e))s[o]=typeof a=="number"?A(a,r,new Set(t)):a;return s}return e}function K(n,r){if(!n||typeof n!="object")return null;if(n[r])return n[r];for(let t in n){let e=K(n[t],r);if(e)return e}return null}function ge(n){let r=[],t=n.subtitle_links||[];if(Array.isArray(t))for(let e of t)e.url&&r.push({url:e.url,lang:e.language||"English",label:e.language||"English"});if(n.nodes){for(let e of n.nodes)if(e&&e.data){let s=e.data,o=s.find(a=>a&&(a.subtitles||a.tracks));if(o){let a=o.subtitles||o.tracks||[];if(typeof a=="number"&&(a=s[a]||[]),Array.isArray(a))for(let u of a){let i=A(u,s);i&&i.url&&r.push({url:i.url,lang:i.language||i.label||"English",label:i.language||i.label||"English"})}}}}return r}function G(n){return p(this,null,function*(){var r;try{let t=new URL(n),e=`${t.origin}${t.pathname}/__data.json${t.search}`,o=(yield I.default.get(e,{headers:{Referer:"https://kuudere.ru/","User-Agent":m}})).data,a=ge(o),u=(r=o.nodes)==null?void 0:r.find(U=>U&&U.data&&U.data.some(N=>N&&N.obfuscation_seed));if(!u)return{url:null,subtitles:a};let i=u.data,c=i.findIndex(U=>U&&U.obfuscation_seed),l=i[c],d=i[l.obfuscation_seed],h=S.default.SHA256(d).toString(),g={keyField:`kf_${h.substring(8,16)}`,ivField:`ivf_${h.substring(16,24)}`,tokenField:`${h.substring(48,64)}_${h.substring(56,64)}`},y=A(c,i),f=K(y,g.keyField),R=K(y,g.ivField),$=y[g.tokenField];if(!$||!f||!R)return{url:null,subtitles:a};let ne=(yield I.default.get(`${t.origin}/api/m3u8/${$}`,{headers:{Referer:n,"User-Agent":m,"X-Requested-With":"XMLHttpRequest"}})).data.video_b64,se=S.default.enc.Base64.parse(f),oe=S.default.enc.Base64.parse(R),ae=S.default.enc.Base64.parse(ne);return{url:S.default.AES.decrypt({ciphertext:ae},se,{iv:oe,mode:S.default.mode.CBC,padding:S.default.pad.Pkcs7}).toString(S.default.enc.Utf8),subtitles:a}}catch(t){return null}})}var L=b(require("axios"));function ye(n){try{let r=n.match(new RegExp("eval\\(function\\(p,a,c,k,e,d\\)\\{.*?\\}\\((.*)\\)\\)","s"));if(!r)return null;let t=r[1],e=[],s="",o=!1,a="",u=0;for(let i=0;i<t.length;i++){let c=t[i];if(c==="\\"&&o){s+=c+t[++i];continue}if((c==="'"||c==='"'||c==="`")&&(!o||a===c)){o=!o,a=o?c:"",s+=c;continue}o||(c==="("&&u++,c===")"&&u--),c===","&&!o&&u===0?(e.push(s.trim()),s=""):s+=c}if(e.push(s.trim()),e.length>=4){let i=e[0].substring(1,e[0].length-1),c=parseInt(e[1]),l=parseInt(e[2]),d=e[3].match(new RegExp(`['"](.*?)['"]`,"s"));if(!d)return null;let h=d[1].split("|"),g=function(f){return(f<c?"":g(parseInt(f/c)))+((f=f%c)>35?String.fromCharCode(f+29):f.toString(36))},y={};for(let f=0;f<h.length;f++)h[f]&&(y[g(f)]=h[f]);return i.replace(/\b\w+\b/g,f=>y[f]||f)}}catch(r){}return null}function we(n,r){return p(this,null,function*(){if(n.includes("main.js?v=1.1.3")||n.includes("Page is loading, please wait...")){let t=new URL(r),e=["hgplaycdn.com","wishembed.com","strwish.com","dwish.pro","awish.pro","hlswish.com"];for(let s of e){if(s===t.hostname)continue;let o=`https://${s}${t.pathname}${t.search}`;try{let a=yield L.default.get(o,{headers:{Referer:"https://kuudere.ru/","User-Agent":m},timeout:3e3});if(a.data.includes("jwplayer")||a.data.includes("eval(function(p,a,c,k,e,d)"))return a.data}catch(a){}}}return n})}function X(n){return p(this,null,function*(){try{let t=(yield L.default.get(n,{headers:{Referer:"https://kuudere.ru/","User-Agent":m},timeout:5e3})).data;t=yield we(t,n);let e=null,s=ye(t);if(s){let o=s.match(/"hls4"\s*:\s*"([^"]+)"/),a=s.match(/"hls3"\s*:\s*"([^"]+)"/),u=s.match(/"hls2"\s*:\s*"([^"]+)"/);if(e=o&&o[1]||a&&a[1]||u&&u[1],!e){let i=s.match(/file\s*:\s*"([^"]+\.(?:m3u8|txt)[^"]*)"/)||s.match(/sources\s*:\s*\[\s*{\s*file\s*:\s*"([^"]+)"/);i&&(e=i[1])}}if(!e){let o=t.match(/file\s*:\s*"([^"]+\.(?:m3u8|txt)[^"]*)"/)||t.match(/sources\s*:\s*\[\s*{\s*file\s*:\s*"([^"]+)"/);o&&(e=o[1])}return e?(e.startsWith("/")&&(e=new URL(n).origin+e),{url:e}):null}catch(r){return null}})}var z=b(require("axios"));function be(n){let r=[];try{let t=new URL(n);for(let[e,s]of t.searchParams.entries())if(e.startsWith("caption_")){let o=e.replace("caption_","");r.push({url:s,lang:`Caption ${o}`,label:`Caption ${o}`})}}catch(t){}return r}function Se(n){try{let r=n.match(/eval\(function\(p,a,c,k,e,d\)\{.*?\}\((.*)\)\)/);if(r){let t=r[1].match(/'(.*?)',(\d+),(\d+),'(.*?)'\.split\('\|'\)/);if(t){let[e,s,o,a,u]=t;o=parseInt(o),a=parseInt(a),u=u.split("|");let i=function(c){return(c<o?"":i(parseInt(c/o)))+((c=c%o)>35?String.fromCharCode(c+29):c.toString(36))};{let c={};for(;a--;)c[i(a)]=u[a]||i(a);u=[function(l){return c[l]}],a=1}for(;a--;)u[a]&&(s=s.replace(new RegExp("\\b\\w+\\b","g"),function(c){return u[a](c)||c}));return s}}}catch(r){}return null}function V(n){return p(this,null,function*(){try{let t=(yield z.default.get(n,{headers:{Referer:"https://kuudere.ru/","User-Agent":m}})).data,e=null,s=t.match(/file\s*:\s*"([^"]+\.(?:m3u8|txt)[^"]*)"/)||t.match(/sources\s*:\s*\[\s*{\s*file\s*:\s*"([^"]+)"/);if(s)e=s[1];else{let a=Se(t);if(a){let u=a.match(/"hls4"\s*:\s*"([^"]+)"/),i=a.match(/"hls3"\s*:\s*"([^"]+)"/),c=a.match(/"hls2"\s*:\s*"([^"]+)"/);if(e=u&&u[1]||i&&i[1]||c&&c[1],!e){let l=a.match(/file\s*:\s*"([^"]+\.(?:m3u8|txt)[^"]*)"/)||a.match(/sources\s*:\s*\[\s*{\s*file\s*:\s*"([^"]+)"/);l&&(e=l[1])}}}if(!e)return null;e.startsWith("/")&&(e=new URL(n).origin+e);let o=be(n);return{url:e,subtitles:o}}catch(r){return null}})}var T=b(require("axios"));function J(n){return p(this,null,function*(){try{let e=(yield T.default.get(n,{headers:{"User-Agent":m}})).data.match(/\/pass_md5\/([^']*)/);if(!e)return null;let s=e[1],o=`${new URL(n).origin}/pass_md5/${s}`;return{url:`${(yield T.default.get(o,{headers:{Referer:n,"User-Agent":m}})).data}${(l=>{let d="",h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let g=0;g<l;g++)d+=h.charAt(Math.floor(Math.random()*h.length));return d})(10)}?token=${s}&expiry=${Date.now()}`,subtitles:[]}}catch(r){return null}})}var Z=b(require("axios"));function ke(n){try{let r=n.match(/eval\(function\(p,a,c,k,e,d\)\{.*?\}\((.*)\)\)/);if(r){let t=r[1].match(/'(.*?)',(\d+),(\d+),'(.*?)'\.split\('\|'\)/);if(t){let[e,s,o,a,u]=t;o=parseInt(o),a=parseInt(a),u=u.split("|");let i=function(c){return(c<o?"":i(parseInt(c/o)))+((c=c%o)>35?String.fromCharCode(c+29):c.toString(36))};{let c={};for(;a--;)c[i(a)]=u[a]||i(a);u=[function(l){return c[l]}],a=1}for(;a--;)u[a]&&(s=s.replace(new RegExp("\\b\\w+\\b","g"),function(c){return u[a](c)||c}));return s}}}catch(r){}return null}function Y(n){return p(this,null,function*(){try{let t=(yield Z.default.get(n,{headers:{"User-Agent":m,Referer:"https://kuudere.ru/"}})).data,e=t.match(/src\s*:\s*"([^"]+\.mp4)"/);if(!e){let s=ke(t);s&&(e=s.match(/src\s*:\s*"([^"]+\.mp4)"/))}return e?{url:e[1],subtitles:[]}:null}catch(r){return null}})}var ee=b(require("axios")),k=b(require("crypto-js"));var v=(...n)=>String.fromCharCode(...n),D=(n,r)=>n.charCodeAt(r)||0;function Re(n){let r="10",e="",s="7519".split("");for(let o=0;o<s.length;o++)e+=v(parseInt(r+s[o]));return e+=v(D(n,1)),e+=e.substring(1,3),e+=v(110,109,117),e.padEnd(16,"\0")}function xe(n,r){let t=n.replace(":",""),e=t+"//",s=t.length*e.length,o=1,a="";for(let g=o;g<10;g++)a+=v(g+s);let u="111",i=u.length*D(r,0),c=parseInt(u)*o+t.length,l=c+4,d=D(t,o),h=d*o-2;return a+=v(s,parseInt(u),i,c,l,d,h),a.substring(0,16)}function Q(n){let r=[];for(let t=0;t<n.length;t++)r[t>>>2]|=(n[t]&255)<<24-t%4*8;return k.default.lib.WordArray.create(r,n.length)}function te(n){return p(this,null,function*(){try{let r=new URL(n),t=r.hostname,e=r.protocol,s=r.hash.substring(1).split("&")[0];if(!s)return null;let o=`${e}//${t}/api/v1/info?id=${s}`,u=(yield ee.default.get(o,{headers:{"User-Agent":m,Referer:n,"X-Requested-With":"XMLHttpRequest"},timeout:5e3})).data;if(typeof u!="string")return null;let i=Re(m),c=xe(e,t),l=Q(Array.from(i).map(f=>f.charCodeAt(0))),d=Q(Array.from(c).map(f=>f.charCodeAt(0))),h=k.default.enc.Hex.parse(u),g=k.default.AES.decrypt({ciphertext:h},l,{iv:d,mode:k.default.mode.CBC,padding:k.default.pad.Pkcs7}),y="";try{y=g.toString(k.default.enc.Utf8)}catch(f){y=g.toString(k.default.enc.Latin1)}if((!y||!y.includes("sources"))&&(y=g.toString(k.default.enc.Latin1)),y&&y.includes("sources")){let f=y.substring(y.indexOf("{"),y.lastIndexOf("}")+1),R=JSON.parse(f);if(R.sources&&R.sources.length>0){let $=R.sources.find(w=>w.type==="hls"||w.file&&w.file.includes(".m3u8"))||R.sources[0];return{url:$.file||$.src,subtitles:(R.subtitles||[]).map(w=>({url:w.file||w.src,lang:w.label||w.language||"Unknown",label:w.label||w.language||"Unknown"}))}}}}catch(r){}return null})}function W(n){return p(this,null,function*(){let r=[];for(let t of n)try{let e=t.serverName,s=t.dataLink,o=null,a="Auto",u={},i=e.toLowerCase();if(i.includes("zen")?(o=yield G(s),a="1080p",u={Referer:"https://zencloudz.cc/"}):i.includes("wish")||i.includes("s-wish")||i.includes("h-wish")?(o=yield X(s),u={Referer:new URL(s).origin}):i.includes("vidhide")||i.includes("s-hide")||i.includes("h-hide")?(o=yield V(s),u={Referer:new URL(s).origin}):i.includes("doodstream")?(o=yield J(s),u={Referer:"https://dood.li/"}):i.includes("mp4upload")?(o=yield Y(s),u={Referer:"https://www.mp4upload.com/"}):i.startsWith("kumi")&&(o=yield te(s),u={Referer:new URL(s).origin}),o&&o.url){let c=o.url,l=o.subtitles||[];r.push({name:`Kuudere (${e})`,title:`${t.dataType.toUpperCase()} - Direct`,url:c,quality:a,headers:u,subtitles:l})}else["Kumi","Kumi-v2","Kumi-v3","Kumi-v4"].includes(e)?r.push({name:`Kuudere (${e})`,title:`${t.dataType.toUpperCase()} - Embed`,url:s,quality:"Auto",headers:{Referer:"https://kuudere.ru/"}}):["Zen","Zen-2","StreamWish","Streamwish","S-Wish","H-Wish","Vidhide","S-Hide","H-Hide","Doodstream","Mp4upload"].includes(e)||r.push({name:`Kuudere (${e})`,title:`${t.dataType.toUpperCase()} - Embed`,url:s,quality:"Auto",headers:{Referer:"https://kuudere.ru/"}})}catch(e){}return r})}function Ue(n){if(!n||!n.nodes)return[];let r=n.nodes.find(a=>a&&a.data&&a.data.some(u=>u&&u.animeData));if(!r)return[];let t=r.data,e=t.find(a=>a&&a.animeData),s=t[t.indexOf(e)+1],o=[];if(Array.isArray(s))for(let a of s){let u=t[a];if(u&&typeof u=="object"){let i={};for(let[c,l]of Object.entries(u))typeof l=="number"&&t[l]!==void 0?i[c]=t[l]:i[c]=l;o.push({id:i.id,title:i.english||i.title||i.romaji||i.native,poster:i.cover||i.coverImage,year:i.year,type:String(i.type).toLowerCase().includes("movie")?"movie":"tv"})}}return o}function x(n){return n?n.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().replace(/[^\w\s]/g,"").trim():""}function re(n){return p(this,null,function*(){try{let r=yield _("get",`/search/__data.json?keyword=${encodeURIComponent(n)}`),t=Ue(r.data);if(t.length===0){let e=yield _("get",`/api/search?q=${encodeURIComponent(n)}`);e.data&&e.data.results&&(t=e.data.results.map(s=>({title:s.title,id:s.id,poster:s.coverImage,type:s.details.toLowerCase().includes("movie")?"movie":"tv"})))}return t.map(e=>({name:"Kuudere",title:e.title,url:e.id,poster:e.poster,year:e.year,type:e.type}))}catch(r){return console.error("[Kuudere] Search error:",r.message),[]}})}function $e(n,r,t,e){return p(this,null,function*(){try{let s=yield H(n,r);if(!s)return[];let o=x(s.title),a=s.year;console.log(`[Kuudere] Searching for: ${s.title} (${s.year})`);let u=yield re(s.title.replace(/[^\x00-\x7F]/g,"")),i=null;if(r==="tv"&&t&&parseInt(t)>1){let d=x(`${s.title} Season ${t}`);i=u.find(h=>x(h.title)===d),i||(i=u.find(h=>x(h.title).includes(d)))}if(i||(i=u.find(d=>x(d.title)===o&&(String(d.year)===String(a)||!d.year)),i||(i=u.find(d=>x(d.title)===o)),i||(i=u.find(d=>x(d.title).includes(o)))),!i)return console.log("[Kuudere] No matching anime found."),[];console.log(`[Kuudere] Found match: ${i.title} (${i.url})`);let l=(yield _("get",`/api/watch/${i.url}/${e}`)).data;return!l.episode_links||l.episode_links.length===0?(console.log("[Kuudere] No stream links found for this episode."),[]):yield W(l.episode_links)}catch(s){return[]}})}module.exports={getStreams:$e,search:re,extractStreams:W};
