/**
 * animepahe - Built from src/animepahe/
 * Generated: 2026-01-08T20:20:14.287Z
 */
var W=Object.create;var T=Object.defineProperty;var j=Object.getOwnPropertyDescriptor;var z=Object.getOwnPropertyNames,M=Object.getOwnPropertySymbols,G=Object.getPrototypeOf,D=Object.prototype.hasOwnProperty,Y=Object.prototype.propertyIsEnumerable;var U=(e,t,n)=>t in e?T(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,I=(e,t)=>{for(var n in t||(t={}))D.call(t,n)&&U(e,n,t[n]);if(M)for(var n of M(t))Y.call(t,n)&&U(e,n,t[n]);return e};var X=(e,t,n,o)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of z(t))!D.call(e,s)&&s!==n&&T(e,s,{get:()=>t[s],enumerable:!(o=j(t,s))||o.enumerable});return e};var L=(e,t,n)=>(n=e!=null?W(G(e)):{},X(t||!e||!e.__esModule?T(n,"default",{value:e,enumerable:!0}):n,e));var g=(e,t,n)=>new Promise((o,s)=>{var i=r=>{try{c(n.next(r))}catch(a){s(a)}},f=r=>{try{c(n.throw(r))}catch(a){s(a)}},c=r=>r.done?o(r.value):Promise.resolve(r.value).then(i,f);c((n=n.apply(e,t)).next())});var R="https://animepahe.si",E="https://animepahe.si/api",q={"User-Agent":"Mozilla/5.0 (Linux; Android 10; K) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Mobile Safari/537.36",Cookie:"__ddg2_=1234567890",Referer:"https://animepahe.si/"},F="68e094699525b18a70bab2f86b1fa706";function K(n){return g(this,arguments,function*(e,t={}){console.log(`[AnimePahe] Fetching: ${e}`);let o=yield fetch(e,I({headers:I(I({},q),t.headers)},t));if(!o.ok)throw new Error(`HTTP error ${o.status} for ${e}`);return yield o.text()})}function P(n){return g(this,arguments,function*(e,t={}){let o=yield K(e,t);try{return JSON.parse(o)}catch(s){throw console.error(`[AnimePahe] Failed to parse JSON from ${e}:`,o.substring(0,100)),s}})}function O(e,t){return g(this,null,function*(){let n=`https://api.themoviedb.org/3/${t}/${e}?api_key=${F}`;console.log(`[AnimePahe] Fetching TMDB details from: ${n}`);try{let o=yield P(n),s=o.name||o.title||o.original_name,i=(o.first_air_date||o.release_date||"").substring(0,4);return{title:s,year:i}}catch(o){return console.error("[AnimePahe] Failed to fetch TMDB metadata",o),null}})}var B=L(require("cheerio-without-node-native"));function H(e){return/eval\(function\(/.test(e)}function Q(e){try{let t,n,o,s,i,f,c=/eval\(function\(p,a,c,k,e,d\)\{.+?return p\}\('(.+?)',(\d+),(\d+),'(.+?)'\.split\('\|'\),0,\{\}\)/,r=e.match(c);if(!r)return e;for(t=r[1],n=parseInt(r[2]),o=parseInt(r[3]),s=r[4].split("|"),i=function(a){return(a<n?"":i(parseInt(a/n)))+((a=a%n)>35?String.fromCharCode(a+29):a.toString(36))};o--;)s[o]&&(t=t.replace(new RegExp("\\b"+i(o)+"\\b","g"),s[o]));return t}catch(t){return console.error("Unpack error",t),e}}function V(e,t,n,o){let s="",i=0,f=t[o];for(;i<e.length;){let c=e.indexOf(f,i);if(c===-1)break;let r="";for(let a=i;a<c;a++)r+=t.indexOf(e[a]);i=c+1;try{let a=String.fromCharCode(parseInt(r,o)-n);s+=a}catch(a){}}return s}function J(e){return g(this,null,function*(){console.log(`[Kwik] Extracting: ${e}`);let t=e;if(e.includes("pahe.win"))try{let r=yield fetch(`${e}/i`,{redirect:"manual"});if(r.status===302||r.status===301){let a=r.headers.get("location");if(a){let w=a.lastIndexOf("https://");w!==-1?t=a.substring(w):t=a}}else{let a=yield r.text()}}catch(r){console.log("[Kwik] Pahe redirect check failed:",r)}console.log(`[Kwik] Target URL: ${t}`);let n=yield fetch(t,{headers:{Referer:"https://animepahe.si/"}}),o=yield n.text(),s=n.headers.get("set-cookie")||"",i=o.match(/source=\s*['"](.*?)['"]/);if(i)return i[1];let f=/\(\"(\w+)\",\d+,\"(\w+)\",(\d+),(\d+),\d+\)/,c=o.match(f);if(c){console.log("[Kwik] Found obfuscated parameters, decrypting...");let[r,a,w,k,d]=c,y=V(a,w,parseInt(k),parseInt(d)),$=y.match(/action=\"([^\"]+)\"/),_=y.match(/value=\"([^\"]+)\"/);if($&&_){let p=$[1],x=_[1];console.log(`[Kwik] POST to ${p} with token ${x}`);let b=yield fetch(p,{method:"POST",headers:{Referer:t,Cookie:s,"User-Agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/126.0.0.0 Safari/537.36","Content-Type":"application/x-www-form-urlencoded"},body:`_token=${x}`,redirect:"manual"});if(b.status===302||b.status===301)return b.headers.get("location")}}if(H(o)){let r=B.default.load(o),a=null;if(r("script").each((w,k)=>{let d=r(k).html();if(d&&H(d)){let $=Q(d).match(/source=\s*['"](.*?)['"]/);$&&(a=$[1])}}),a)return a}return null})}var v=L(require("cheerio-without-node-native"));function Z(e,t,n,o){return g(this,null,function*(){try{n||(n=1),o||(o=1);let s=yield O(e,t);if(!s)return[];let{title:i,year:f}=s;console.log(`[AnimePahe] Processing: ${i} (${f}) S${n}E${o}`);let c=`${E}?m=search&l=8&q=${encodeURIComponent(i)}`,r=yield P(c);if(!r||!r.data||r.data.length===0)return console.log("[AnimePahe] No search results found."),[];let a=r.data.find(l=>l.title.toLowerCase()===i.toLowerCase());!a&&f&&(a=r.data.find(l=>l.year==f)),a||(a=r.data[0]),console.log(`[AnimePahe] Selected Anime: ${a.title} (Session: ${a.session})`);let w=a.session,k=1,d=null,y=1;for(;!d&&k<=y;){let l=`${E}?m=release&id=${w}&sort=episode_asc&page=${k}`,h=yield P(l);y=h.last_page;let u=h.data.find(m=>m.episode==o);u?(d=u.session,console.log(`[AnimePahe] Found Episode ${o} (Session: ${d})`)):k++}if(!d)return console.log(`[AnimePahe] Episode ${o} not found.`),[];let $=`${R}/play/${w}/${d}`,_=yield K($),p=v.default.load(_),x=[];p("#resolutionMenu button").each((l,h)=>{let u=p(h).attr("data-src"),m=p(h).text(),A=m.match(/(\d{3,4}p)/),C=A?A[1]:"Unknown",S=m.toLowerCase().includes("eng")||m.toLowerCase().includes("dub")?"Dub":"Sub";u&&u.includes("kwik")&&x.push({url:u,quality:C,lang:S,type:"kwik"})}),p("div#pickDownload > a").each((l,h)=>{let u=p(h).attr("href"),m=p(h).text(),A=m.match(/(\d{3,4}p)/),C=A?A[1]:"Unknown",S=m.toLowerCase().includes("eng")||m.toLowerCase().includes("dub")?"Dub":"Sub";u&&(u.includes("kwik")?x.push({url:u,quality:C,lang:S,type:"kwik"}):x.push({url:u,quality:C,lang:S,type:"pahe"}))});let b=[];for(let l of x)try{let h=yield J(l.url);h&&b.push({name:`AnimePahe ${l.lang}`,title:`AnimePahe ${l.quality} ${l.lang}`,url:h,quality:l.quality})}catch(h){console.error(`[AnimePahe] Failed to extract Kwik: ${h.message}`)}return b}catch(s){return console.error(`[AnimePahe] Error: ${s.message}`),[]}})}module.exports={getStreams:Z};
