/**
 * animepahe - Built from src/animepahe/
 * Generated: 2026-01-10T12:10:20.313Z
 */
var Z=Object.create;var C=Object.defineProperty,ee=Object.defineProperties,te=Object.getOwnPropertyDescriptor,re=Object.getOwnPropertyDescriptors,oe=Object.getOwnPropertyNames,D=Object.getOwnPropertySymbols,ne=Object.getPrototypeOf,H=Object.prototype.hasOwnProperty,se=Object.prototype.propertyIsEnumerable;var q=(e,t,r)=>t in e?C(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,A=(e,t)=>{for(var r in t||(t={}))H.call(t,r)&&q(e,r,t[r]);if(D)for(var r of D(t))se.call(t,r)&&q(e,r,t[r]);return e},F=(e,t)=>ee(e,re(t));var ae=(e,t,r,o)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of oe(t))!H.call(e,n)&&n!==r&&C(e,n,{get:()=>t[n],enumerable:!(o=te(t,n))||o.enumerable});return e};var ie=(e,t,r)=>(r=e!=null?Z(ne(e)):{},ae(t||!e||!e.__esModule?C(r,"default",{value:e,enumerable:!0}):r,e));var p=(e,t,r)=>new Promise((o,n)=>{var a=l=>{try{h(r.next(l))}catch(s){n(s)}},i=l=>{try{h(r.throw(l))}catch(s){n(s)}},h=l=>l.done?o(l.value):Promise.resolve(l.value).then(a,i);h((r=r.apply(e,t)).next())});var z="https://animepahe.si",K="https://animepahe.si/api",G={"User-Agent":"Mozilla/5.0 (Linux; Android 10; K) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Mobile Safari/537.36",Cookie:"__ddg2_=1234567890",Referer:"https://animepahe.si/"},B="68e094699525b18a70bab2f86b1fa706";function I(r){return p(this,arguments,function*(e,t={}){console.log(`[AnimePahe] Fetching: ${e}`);let o=yield fetch(e,A({headers:A(A({},G),t.headers)},t));if(!o.ok)throw new Error(`HTTP error ${o.status} for ${e}`);return yield o.text()})}function $(r){return p(this,arguments,function*(e,t={}){let o=yield I(e,t);try{return JSON.parse(o)}catch(n){throw console.error(`[AnimePahe] Failed to parse JSON from ${e}`),n}})}function J(e,t){return p(this,null,function*(){let o=`https://api.themoviedb.org/3/${t==="tv"||t==="series"?"tv":"movie"}/${e}?api_key=${B}`;try{let n=yield $(o),a=n.name||n.title||n.original_name,i=(n.first_air_date||n.release_date||"").substring(0,4);return{title:a,year:i}}catch(n){return null}})}function ce(e){try{let t=e.match(new RegExp("eval\\(function\\(p,a,c,k,e,d\\)\\{.*?\\}\\((.*)\\)\\)","s"));if(!t)return e;let r=t[1],o=[],n="",a=!1,i="",h=0;for(let l=0;l<r.length;l++){let s=r[l];if(s==="\\"&&a){n+=s+r[++l];continue}if((s==="'"||s==='"'||s==="`")&&(!a||i===s)){a=!a,i=a?s:"",n+=s;continue}a||(s==="("&&h++,s===")"&&h--),s===","&&!a&&h===0?(o.push(n.trim()),n=""):n+=s}if(o.push(n.trim()),o.length>=4){let l=o[0].substring(1,o[0].length-1),s=parseInt(o[1]),g=parseInt(o[2]),m=o[3].match(new RegExp(`['"](.*?)['"]`,"s"));if(!m)return e;let w=m[1].split("|"),b=function(c){return(c<s?"":b(parseInt(c/s)))+((c=c%s)>35?String.fromCharCode(c+29):c.toString(36))},y={};for(let c=0;c<w.length;c++)w[c]&&(y[b(c)]=w[c]);return l.replace(/\b\w+\b/g,c=>y[c]||c)}}catch(t){}return e}function le(e,t,r,o){let n="",a=0,i=t[o];for(;a<e.length;){let h=e.indexOf(i,a);if(h===-1)break;let l="";for(let s=a;s<h;s++)l+=t.indexOf(e[s]);a=h+1;try{let s=String.fromCharCode(parseInt(l,o)-r);n+=s}catch(s){}}return n}function O(e){return p(this,null,function*(){console.log(`[Kwik] Extracting: ${e}`);let t=e;if(e.includes("pahe.win"))try{let r=yield fetch(`${e}/i`,{method:"GET",redirect:"manual",headers:{"User-Agent":"Mozilla/5.0 (Linux; Android 10; K) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Mobile Safari/537.36"}});if(r.status===302||r.status===301){let o=r.headers.get("location");if(o){let n=o.lastIndexOf("https://");t=n!==-1?o.substring(n):o}}}catch(r){}console.log(`[Kwik] Final Target: ${t}`);try{let r=yield fetch(t,{headers:{Referer:"https://animepahe.si/","User-Agent":"Mozilla/5.0 (Linux; Android 10; K) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Mobile Safari/537.36"}}),o=yield r.text(),n=r.headers.get("set-cookie");if(o.includes("DDoS-Guard"))return console.log("[Kwik] Blocked by DDoS-Guard"),null;let a=ce(o);if(a!==o){let s=a.match(/source=\s*['"](.*?)['"]/);if(s)return s[1]}let i=/\(\"(\w+)\",\d+,\"(\w+)\",(\d+),(\d+),\d+\)/,h=o.match(i);if(h){let[s,g,m,w,b]=h,y=le(g,m,parseInt(w),parseInt(b)),c=y.match(/action=\"([^\"]+)\"/),S=y.match(/value=\"([^\"]+)\"/);if(c&&S){let M=c[1],P=S[1];for(let d=0;d<5;d++){let x=yield fetch(M,{method:"POST",headers:{Referer:t,Cookie:n||"","User-Agent":"Mozilla/5.0 (Linux; Android 10; K) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Mobile Safari/537.36","Content-Type":"application/x-www-form-urlencoded"},body:`_token=${P}`,redirect:"manual"});if(x.status===302||x.status===301)return x.headers.get("location")}}}let l=o.match(/source=\s*['"](.*?)['"]/);if(l)return l[1]}catch(r){console.error(`[Kwik] Extraction error: ${r.message}`)}return null})}function L(e){return p(this,null,function*(){try{let t=`${K}?m=search&l=8&q=${encodeURIComponent(e)}`,r=yield $(t);return!r||!r.data||r.data.length===0?[]:r.data.map(o=>({name:"AnimePahe",title:o.title,url:o.session,poster:o.poster,year:o.year,type:o.type.toLowerCase().includes("movie")?"movie":"tv"}))}catch(t){return console.error(`[AnimePahe] Search error: ${t.message}`),[]}})}function W(e){return e?e.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().replace(/[^\w\s]/g," ").replace(/\s+/g," ").trim():""}function N(e,t){let r=W(e).replace(/\s+/g,""),o=W(t).replace(/\s+/g,"");if(r===o)return 1;if(r.length<2||o.length<2)return 0;let n=new Set;for(let i=0;i<r.length-1;i++)n.add(r.substring(i,i+2));let a=0;for(let i=0;i<o.length-1;i++){let h=o.substring(i,i+2);n.has(h)&&a++}return 2*a/(r.length+o.length-2)}var Y=ie(require("cheerio-without-node-native"));function ue(e,t,r,o,n=null){return p(this,null,function*(){try{let a=n||(yield J(e,t));if(!a)return[];let{title:i,year:h}=a,l=t==="movie"?"movie":"tv";console.log(`[AnimePahe] Processing: ${i} (${h}) [${l}]`);let s=[i.replace(/[^\x00-\x7F]/g," ").replace(/\s+/g," ").trim(),i.split(/[:\-\–\—]/)[0].trim()],g=[];for(let u of s){if(u.length<3)continue;let f=yield L(u);g=[...g,...f]}let m=new Set,c=g.filter(u=>m.has(u.url)?!1:(m.add(u.url),!0)).filter(u=>u.type===l).map(u=>{let f=N(u.title,i);return u.year&&h&&String(u.year)===String(h)&&(f+=.4),F(A({},u),{score:f})}).sort((u,f)=>f.score-u.score)[0];if(!c||c.score<.75)return console.log("[AnimePahe] No valid match found."),[];console.log(`[AnimePahe] Found match: ${c.title} (Score: ${c.score.toFixed(2)})`);let S=c.url,M=o||1,P=1,d=null,x=1;for(;!d&&P<=x;){let u=`${K}?m=release&id=${S}&sort=episode_asc&page=${P}`,f=yield $(u);x=f.last_page;let k=f.data.find(R=>R.episode==M);k?(d=k.session,console.log(`[AnimePahe] Resolved Episode ${M}`)):P++}if(!d)return console.log(`[AnimePahe] Episode ${M} not found.`),[];let j=`${z}/play/${S}/${d}`,Q=yield I(j),v=Y.default.load(Q),T=[];v("#resolutionMenu button, div#pickDownload > a").each((u,f)=>{let k=v(f),R=k.attr("data-src")||k.attr("href"),_=k.text();if(R&&R.includes("kwik")){let U=_.match(/(\d{3,4}p)/),V=U?U[1]:"Auto",X=_.toLowerCase().includes("eng")||_.toLowerCase().includes("dub")?"Dub":"Sub";T.push({url:R,quality:V,lang:X})}});let E=[];for(let u of T)try{let f=yield O(u.url);f&&E.push({name:`AnimePahe ${u.lang}`,title:`AnimePahe ${u.quality} ${u.lang}`,url:f,quality:u.quality})}catch(f){}return E}catch(a){return console.error(`[AnimePahe] getStreams error: ${a.message}`),[]}})}module.exports={getStreams:ue,search:L};
