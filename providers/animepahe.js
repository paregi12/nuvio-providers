/**
 * animepahe - Built from src/animepahe/
 * Generated: 2026-01-10T12:44:50.533Z
 */
var Z=Object.create;var _=Object.defineProperty,ee=Object.defineProperties,te=Object.getOwnPropertyDescriptor,oe=Object.getOwnPropertyDescriptors,re=Object.getOwnPropertyNames,W=Object.getOwnPropertySymbols,ne=Object.getPrototypeOf,D=Object.prototype.hasOwnProperty,se=Object.prototype.propertyIsEnumerable;var q=(e,t,o)=>t in e?_(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,S=(e,t)=>{for(var o in t||(t={}))D.call(t,o)&&q(e,o,t[o]);if(W)for(var o of W(t))se.call(t,o)&&q(e,o,t[o]);return e},H=(e,t)=>ee(e,oe(t));var ae=(e,t,o,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of re(t))!D.call(e,n)&&n!==o&&_(e,n,{get:()=>t[n],enumerable:!(r=te(t,n))||r.enumerable});return e};var ie=(e,t,o)=>(o=e!=null?Z(ne(e)):{},ae(t||!e||!e.__esModule?_(o,"default",{value:e,enumerable:!0}):o,e));var p=(e,t,o)=>new Promise((r,n)=>{var a=l=>{try{h(o.next(l))}catch(s){n(s)}},c=l=>{try{h(o.throw(l))}catch(s){n(s)}},h=l=>l.done?r(l.value):Promise.resolve(l.value).then(a,c);h((o=o.apply(e,t)).next())});var z="https://animepahe.si",P="https://animepahe.si/api",F={"User-Agent":"Mozilla/5.0 (Linux; Android 10; K) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Mobile Safari/537.36",Cookie:"__ddg2_=1234567890",Referer:"https://animepahe.si/"},G="68e094699525b18a70bab2f86b1fa706";function K(o){return p(this,arguments,function*(e,t={}){console.log(`[AnimePahe] Fetching: ${e}`);let r=yield fetch(e,S({headers:S(S({},F),t.headers)},t));if(!r.ok)throw new Error(`HTTP error ${r.status} for ${e}`);return yield r.text()})}function M(o){return p(this,arguments,function*(e,t={}){let r=yield K(e,t);try{return JSON.parse(r)}catch(n){throw console.error(`[AnimePahe] Failed to parse JSON from ${e}`),n}})}function N(e,t){return p(this,null,function*(){let r=`https://api.themoviedb.org/3/${t==="tv"||t==="series"?"tv":"movie"}/${e}?api_key=${G}`;try{let n=yield M(r),a=n.name||n.title||n.original_name,c=(n.first_air_date||n.release_date||"").substring(0,4);return{title:a,year:c}}catch(n){return null}})}function ce(e){try{let t=e.match(new RegExp("eval\\(function\\(p,a,c,k,e,d\\)\\{.*?\\}\\((.*)\\)\\)","s"));if(!t)return e;let o=t[1],r=[],n="",a=!1,c="",h=0;for(let l=0;l<o.length;l++){let s=o[l];if(s==="\\"&&a){n+=s+o[++l];continue}if((s==="'"||s==='"'||s==="`")&&(!a||c===s)){a=!a,c=a?s:"",n+=s;continue}a||(s==="("&&h++,s===")"&&h--),s===","&&!a&&h===0?(r.push(n.trim()),n=""):n+=s}if(r.push(n.trim()),r.length>=4){let l=r[0].substring(1,r[0].length-1),s=parseInt(r[1]),m=parseInt(r[2]),d=r[3].match(new RegExp(`['"](.*?)['"]`,"s"));if(!d)return e;let g=d[1].split("|"),k=function(i){return(i<s?"":k(parseInt(i/s)))+((i=i%s)>35?String.fromCharCode(i+29):i.toString(36))},y={};for(let i=0;i<g.length;i++)g[i]&&(y[k(i)]=g[i]);return l.replace(/\b\w+\b/g,i=>y[i]||i)}}catch(t){}return e}function le(e,t,o,r){let n="",a=0,c=t[r];for(;a<e.length;){let h=e.indexOf(c,a);if(h===-1)break;let l="";for(let s=a;s<h;s++)l+=t.indexOf(e[s]);a=h+1;try{let s=String.fromCharCode(parseInt(l,r)-o);n+=s}catch(s){}}return n}function B(e){return p(this,null,function*(){console.log(`[Kwik] Extracting: ${e}`);let t=e;if(e.includes("pahe.win"))try{let o=yield fetch(`${e}/i`,{method:"GET",redirect:"manual",headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36"}});if(o.status===302||o.status===301){let r=o.headers.get("location");if(r){let n=r.lastIndexOf("https://");t=n!==-1?r.substring(n):r}}}catch(o){}console.log(`[Kwik] Final Target: ${t}`);try{let o=yield fetch(t,{headers:{Referer:"https://animepahe.si/","User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36"}}),r=yield o.text(),n=o.headers.get("set-cookie");if(r.includes("DDoS-Guard"))return console.log("[Kwik] Blocked by DDoS-Guard"),null;let a=r.match(new RegExp("eval\\(function\\(p,a,c,k,e,d\\).*?\\}\\(.*\\)\\)","gs"));if(a)for(let s of a){let m=ce(s),d=m.match(/(?:source|q|file)\s*[:=]\s*['"](https?:\/\/.*?\.(?:m3u8|mp4|uwu)[^'"]*)['"]/);if(d)return d[1];let g=m.match(/action=\"([^\"]+)\"/),k=m.match(/value=\"([^\"]+)\"/);if(g&&k){let y=g[1],i=k[1];for(let x=0;x<10;x++){let w=yield fetch(y,{method:"POST",headers:{Referer:t,Cookie:n||"","User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36","Content-Type":"application/x-www-form-urlencoded"},body:`_token=${i}`,redirect:"manual"});if(w.status===302||w.status===301)return w.headers.get("location")}}}let c=/\(\"(\w+)\",\d+,\"(\w+)\",(\d+),(\d+),\d+\)/,h=r.match(c);if(h){let[s,m,d,g,k]=h,y=le(m,d,parseInt(g),parseInt(k)),i=y.match(/action=\"([^\"]+)\"/),x=y.match(/value=\"([^\"]+)\"/);if(i&&x){let w=i[1],R=x[1];for(let $=0;$<10;$++){let A=yield fetch(w,{method:"POST",headers:{Referer:t,Cookie:n||"","User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36","Content-Type":"application/x-www-form-urlencoded"},body:`_token=${R}`,redirect:"manual"});if(A.status===302||A.status===301)return A.headers.get("location")}}}let l=r.match(/(?:source|q|file)\s*[:=]\s*['"](https?:\/\/.*?\.(?:m3u8|mp4|uwu)[^'"]*)['"]/);if(l)return l[1]}catch(o){console.error(`[Kwik] Extraction error: ${o.message}`)}return null})}function v(e){return p(this,null,function*(){try{let t=`${P}?m=search&l=8&q=${encodeURIComponent(e)}`,o=yield M(t);return!o||!o.data||o.data.length===0?[]:o.data.map(r=>({name:"AnimePahe",title:r.title,url:r.session,poster:r.poster,year:r.year,type:r.type.toLowerCase().includes("movie")?"movie":"tv"}))}catch(t){return console.error(`[AnimePahe] Search error: ${t.message}`),[]}})}function O(e){return e?e.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().replace(/[^\w\s]/g," ").replace(/\s+/g," ").trim():""}function J(e,t){let o=O(e).replace(/\s+/g,""),r=O(t).replace(/\s+/g,"");if(o===r)return 1;if(o.length<2||r.length<2)return 0;let n=new Set;for(let c=0;c<o.length-1;c++)n.add(o.substring(c,c+2));let a=0;for(let c=0;c<r.length-1;c++){let h=r.substring(c,c+2);n.has(h)&&a++}return 2*a/(o.length+r.length-2)}var Y=ie(require("cheerio-without-node-native"));function ue(e,t,o,r,n=null){return p(this,null,function*(){try{let a=n||(yield N(e,t));if(!a)return[];let{title:c,year:h}=a,l=t==="movie"?"movie":"tv";console.log(`[AnimePahe] Processing: ${c} (${h}) [${l}]`);let s=[c.replace(/[^\x00-\x7F]/g," ").replace(/\s+/g," ").trim(),c.split(/[:\-\–\—]/)[0].trim()],m=[];for(let u of s){if(u.length<3)continue;let f=yield v(u);m=[...m,...f]}let d=new Set,i=m.filter(u=>d.has(u.url)?!1:(d.add(u.url),!0)).filter(u=>u.type===l).map(u=>{let f=J(u.title,c);return u.year&&h&&String(u.year)===String(h)&&(f+=.4),H(S({},u),{score:f})}).sort((u,f)=>f.score-u.score)[0];if(!i||i.score<.75)return console.log("[AnimePahe] No valid match found."),[];console.log(`[AnimePahe] Found match: ${i.title} (Score: ${i.score.toFixed(2)})`);let x=i.url,w=r||1,R=1,$=null,A=1;for(;!$&&R<=A;){let u=`${P}?m=release&id=${x}&sort=episode_asc&page=${R}`,f=yield M(u);A=f.last_page;let b=f.data.find(C=>C.episode==w);b?($=b.session,console.log(`[AnimePahe] Resolved Episode ${w}`)):R++}if(!$)return console.log(`[AnimePahe] Episode ${w} not found.`),[];let j=`${z}/play/${x}/${$}`,Q=yield K(j),I=Y.default.load(Q),U=[];I("#resolutionMenu button, div#pickDownload > a").each((u,f)=>{let b=I(f),C=b.attr("data-src")||b.attr("href"),T=b.text();if(C&&C.includes("kwik")){let L=T.match(/(\d{3,4}p)/),V=L?L[1]:"Auto",X=T.toLowerCase().includes("eng")||T.toLowerCase().includes("dub")?"Dub":"Sub";U.push({url:C,quality:V,lang:X})}});let E=[];for(let u of U)try{let f=yield B(u.url);f&&E.push({name:`AnimePahe ${u.lang}`,title:`AnimePahe ${u.quality} ${u.lang}`,url:f,quality:u.quality})}catch(f){}return E}catch(a){return console.error(`[AnimePahe] getStreams error: ${a.message}`),[]}})}module.exports={getStreams:ue,search:v};
